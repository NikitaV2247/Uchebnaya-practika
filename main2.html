<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransportCo - Транспортная компания</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Общие стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: 'Open Sans', sans-serif;
            color: #333;
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Система уведомлений */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }

        .notification {
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideIn 0.3s ease-out;
            transform: translateX(0);
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }

        .notification.hiding {
            transform: translateX(100%);
            opacity: 0;
        }

        .notification-success {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }

        .notification-error {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        .notification-warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .notification-info {
            background-color: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        .notification-content {
            flex: 1;
            margin-right: 15px;
            font-size: 14px;
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: inherit;
            opacity: 0.7;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: opacity 0.2s;
        }

        .notification-close:hover {
            opacity: 1;
            background-color: rgba(0, 0, 0, 0.1);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Шапка сайта */
        header {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 40px;
            position: sticky;
            top: 0;
            z-index: 100;
            flex-shrink: 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-family: 'Montserrat', sans-serif;
            font-size: 24px;
            font-weight: bold;
            color: #0047AB;
            text-decoration: none;
            cursor: pointer;
        }

        nav {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        nav a {
            color: #333;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s;
            cursor: pointer;
        }

        nav a:hover {
            color: #0047AB;
        }

        nav a.active {
            color: #0047AB;
            font-weight: 600;
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn-login, .btn-register, .btn-order {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
        }

        .btn-login {
            border: 2px solid #0047AB;
            color: #0047AB;
            background: white;
        }

        .btn-login:hover {
            background: #0047AB;
            color: white;
        }

        .btn-register {
            border: 2px solid #0047AB;
            background: #0047AB;
            color: white;
        }

        .btn-register:hover {
            background: #003580;
        }

        .btn-order {
            border: 2px solid #F49B00;
            background: #F49B00;
            color: white;
        }

        .btn-order:hover {
            background: #d88800;
        }

        /* Основной контент */
        #content {
            flex: 1;
            transition: opacity 0.3s;
            display: flex;
            flex-direction: column;
        }

        .page-content {
            display: none;
            flex: 1;
        }

        .page-content.active {
            display: flex;
            flex-direction: column;
        }

        /* Подвал */
        footer {
            background: #0047AB;
            color: white;
            text-align: center;
            padding: 30px 40px;
            flex-shrink: 0;
            margin-top: auto;
        }

        footer p {
            font-size: 14px;
        }

        /* Стили главной страницы */
        .call {
            background: linear-gradient(135deg, #0047AB 0%, #003580 100%);
            color: white;
            padding: 80px 40px;
            text-align: left;
        }

        .call-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .call h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .call p {
            font-size: 16px;
            margin-bottom: 30px;
            max-width: 600px;
            line-height: 1.6;
        }

        .features {
            padding: 60px 40px;
        }

        .features-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .features h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 36px;
            text-align: center;
            margin-bottom: 50px;
            color: #333;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            text-align: center;
            transition: box-shadow 0.3s;
        }

        .feature-card:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .feature-card h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 18px;
            margin-bottom: 10px;
            color: #333;
        }

        .feature-card p {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        .stats {
            background: linear-gradient(135deg, #0047AB 0%, #003580 100%);
            color: white;
            padding: 60px 40px;
            flex-shrink: 0;
            margin-top: auto;
        }

        .stats-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            text-align: center;
        }

        .stat-item h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-item p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Стили для заголовков страниц */
        .page-header {
            background: linear-gradient(135deg, #0047AB 0%, #003580 100%);
            color: white;
            padding: 60px 40px;
        }

        .page-header-content {
            max-width: 1400px;
            margin: 0 auto;
            text-align: center;
        }

        .page-header h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 42px;
            margin-bottom: 10px;
        }

        .page-header p {
            font-size: 16px;
        }

        /* Контейнер контента */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 60px 40px;
            flex: 1 0 auto;
        }

        
        #profile-page .container {
            max-width: 100%;
            padding: 40px 20px;
            overflow-x: hidden;
        }

        /* Стили "О компании" */
        .about-section {
            margin-bottom: 50px;
        }

        .about-section h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 32px;
            color: #0047AB;
            margin-bottom: 20px;
        }

        .about-section p {
            font-size: 16px;
            line-height: 1.8;
            color: #666;
            margin-bottom: 15px;
        }

        .timeline {
            margin-top: 30px;
        }

        .timeline-item {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid #F49B00;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }

        .timeline-year {
            font-family: 'Montserrat', sans-serif;
            font-size: 20px;
            font-weight: bold;
            color: #0047AB;
            min-width: 80px;
            padding: 8px 12px;
            border-radius: 4px;
            text-align: center;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-content h4 {
            font-family: 'Montserrat', sans-serif;
            font-size: 18px;
            color: #0047AB;
            margin-bottom: 10px;
        }

        .timeline-content p {
            font-size: 14px;
            color: #666;
        }

        .values-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(275px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .value-card {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid #F49B00;
        }

        .value-card h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 18px;
            color: #0047AB;
            margin-bottom: 10px;
        }

        .value-card p {
            font-size: 14px;
            color: #666;
        }

        /* Стили "Контакты" */
        .upper-section {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 60px;
            margin-bottom: 60px;
        }

        .contact-section, .map-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            height: fit-content;
        }

        .contact-section h2, .map-container h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            margin-bottom: 25px;
            color: #0047AB;
        }

        .contact-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .contact-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .contact-item h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 16px;
            color: #F49B00;
            margin-bottom: 8px;
        }

        .contact-item p {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .map-placeholder {
            height: 500px;
            width: 100%;
            background: #e9ecef;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 18px;
        }

        .lower-section {
            margin: 0 -20px;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .contact-form h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            margin-bottom: 25px;
            color: #0047AB;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Open Sans', sans-serif;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0047AB;
            box-shadow: 0 0 0 3px rgba(0, 71, 171, 0.1);
        }

        .contact-submit-btn {
            width: 100%;
            padding: 12px;
            background-color: #F49B00;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            transition: background-color 0.3s;
        }

        .contact-submit-btn:hover {
            background-color: #003580;
        }

        /* Стили формы заказа */
        .order-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 40px;
            flex: 1 0 auto;
        }

        .important-notice {
            background: #FFF9F0;
            border: 1px solid #F49B00;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 40px;
        }

        .form-section {
            margin-bottom: 40px;
        }

        .form-section h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 24px;
            color: #0047AB;
            margin-bottom: 20px;
        }

        .order-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .order-form-group {
            margin-bottom: 20px;
        }

        .order-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .required:after {
            content: " *";
            color: #e74c3c;
        }

        .order-form-group input,
        .order-form-group textarea,
        .order-form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Open Sans', sans-serif;
        }

        .order-form-group input:focus,
        .order-form-group textarea:focus,
        .order-form-group select:focus {
            outline: none;
            border-color: #0047AB;
            box-shadow: 0 0 0 3px rgba(0, 71, 171, 0.1);
        }

        /* Стили для ошибок в форме заказа */
        .order-error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .order-error-message.show {
            display: block;
        }

        .order-form-group input.error,
        .order-form-group textarea.error,
        .order-form-group select.error {
            border-color: #e74c3c;
            background-color: #fff9f9;
        }

        .order-divider {
            height: 1px;
            background: #e0e0e0;
            margin: 30px 0;
        }

        .weight-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .weight-input input {
            flex: 1;
        }

        .weight-input span {
            font-size: 14px;
            color: #666;
        }

        .volume-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-input input {
            flex: 1;
        }

        .volume-input span {
            font-size: 14px;
            color: #666;
        }

        .weight-volume-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .checkbox-group {
            margin-bottom: 15px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
        }

        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }

        .order-submit-btn {
            width: 100%;
            padding: 15px;
            background-color: #F49B00;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            transition: background-color 0.3s;
        }

        .order-submit-btn:hover {
            background-color: #d88800;
        }

        /* Стили для модальных окон */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .auth-container {
            width: 100%;
            max-width: 450px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
        }

        .auth-header {
            color: rgb(0, 0, 0);
            padding: 25px 20px 15px;
            text-align: center;
            position: relative;
        }

        .close-auth-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            transition: background-color 0.3s;
            color: #000;
            background: none;
            border: none;
        }

        .close-auth-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .auth-logo {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            color: #0047AB;
        }

        .auth-subtitle {
            font-size: 16px;
            opacity: 0.8;
        }

        .auth-form-container {
            padding: 25px 30px;
        }

        .auth-input-group {
            margin-bottom: 20px;
        }

        .auth-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .auth-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .auth-input::placeholder {
            color: #999;
            font-size: 14px;
        }

        .auth-input:focus {
            border-color: #0047AB;
            outline: none;
        }

        /* Стили для ошибок */
        .auth-input.error {
            border-color: #e74c3c;
            background-color: #fff9f9;
        }

        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* ОБЩИЙ отступ для строки с чекбоксом и ссылкой - УМЕНЬШЕН для авторизации */
        .auth-options-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        /* Увеличиваем отступ для формы регистрации */
        #registerModal .auth-options-row {
            margin: 25px 0;
        }

        .auth-checkbox-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 5px 0;
            margin-bottom: 30px;
        }

        .auth-custom-checkbox {
            position: relative;
            width: 20px;
            height: 20px;
            border: 2px solid #0047AB;
            border-radius: 4px;
            margin-right: 8px;
            flex-shrink: 0;
            transition: background-color 0.3s;
        }

        .auth-checkbox-container input {
            display: none;
        }

        .auth-checkmark {
            position: absolute;
            top: 1px;
            left: 5px;
            width: 6px;
            height: 12px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .auth-checkbox-container input:checked + .auth-custom-checkbox {
            background-color: #0047AB;
        }

        .auth-checkbox-container input:checked + .auth-custom-checkbox .auth-checkmark {
            opacity: 1;
        }

        .auth-checkbox-text {
            font-size: 14px;
            color: #555;
        }

        /* Ссылка "Забыли пароль" в авторизации */
        .auth-forgot-password {
            font-size: 14px;
            color: #0047AB;
            text-decoration: none;
            cursor: pointer;
            padding: 5px 0;
            transition: color 0.3s;
            text-align: right;
        }

        .auth-forgot-password:hover {
            text-decoration: underline;
        }

        /* Убираем большой отступ снизу у чекбокса в авторизации */
        #loginModal .auth-checkbox-container {
            margin-bottom: 10px;
        }

        .auth-btn {
            width: 100%;
            padding: 14px;
            background: #0047AB;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        /* Кнопка входа с меньшим отступом сверху */
        #loginModal .auth-btn {
            margin-top: 5px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .register-btn {
            background: #F49B00;
        }

        .auth-link {
            text-align: center;
            font-size: 15px;
            color: #555;
            margin-top: 15px;
        }

        .auth-link a {
            color: #0047AB;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .auth-link a:hover {
            text-decoration: underline;
        }

        .auth-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .auth-row .auth-input-group {
            flex: 1;
        }

        /* Стили для модальных окон восстановления пароля */
        .forgot-password-info {
            text-align: center;
            margin: 15px 0 25px;
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .sms-code-info {
            text-align: center;
            margin: 10px 0 25px;
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .sms-code-input {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .sms-code-input input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .sms-code-input input:focus {
            border-color: #0047AB;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 71, 171, 0.1);
        }

        .sms-timer {
            text-align: center;
            margin: 15px 0;
            color: #F49B00;
            font-size: 14px;
            font-weight: 600;
        }

        .resend-code {
            text-align: center;
            margin-top: 15px;
        }

        .resend-code a {
            color: #0047AB;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
        }

        .resend-code a:hover {
            text-decoration: underline;
        }

        .resend-code.disabled a {
            color: #999;
            cursor: not-allowed;
        }

        .resend-code.disabled a:hover {
            text-decoration: none;
        }

        .divider {
            height: 1px;
            background: #e0e0e0;
            margin: 25px 0;
        }

        /* Стили для кнопок в модальных окнах восстановления */
        .forgot-password-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .back-btn {
            flex: 1;
            padding: 14px;
            border: 2px solid #ddd;
            background: white;
            color: #333;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
        }

        .back-btn:hover {
            background: #f5f5f5;
            border-color: #bbb;
        }

        .recovery-btn {
            flex: 1;
            padding: 14px;
            background: #0047AB;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
        }

        .recovery-btn:hover {
            background: #003580;
        }

        /* Стили для кнопок в окне подтверждения кода */
        .confirm-code-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
        }

        /* Растягиваем обе кнопки на всю ширину */
        .confirm-code-buttons .back-btn,
        .confirm-code-buttons .continue-btn {
            width: 100%;
            text-align: center;
        }

        .continue-btn {
            padding: 14px;
            background: #0047AB;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
        }

        .continue-btn:hover {
            background: #003580;
        }

        /* Стили для страницы "Профиль" */
        .profile-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .profile-nav-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            position: relative;
            font-family: 'Montserrat', sans-serif;
            transition: color 0.3s;
        }

        .profile-nav-btn:hover {
            color: #0047AB;
        }

        .profile-nav-btn.active {
            color: #0047AB;
        }

        .profile-nav-btn.active:after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 0;
            right: 0;
            height: 2px;
            background: #0047AB;
        }

        .profile-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin-bottom: 30px;
        }

        .profile-section h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 24px;
            color: #0047AB;
            margin-bottom: 20px;
        }

        .profile-section h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 18px;
            color: #333;
            margin: 25px 0 15px;
        }

        .profile-tab {
            display: block;
        }

        .profile-tab-content {
            width: 100%;
        }

        /* Стили для полей профиля только для чтения */
        .profile-field-readonly {
            border: none;
            background: transparent;
            box-shadow: none;
            pointer-events: none;
            color: #333;
            padding-left: 0;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Open Sans', sans-serif;
        }

        .profile-field-readonly::placeholder {
            color: #333;
        }

        .reset-group {
            display: flex;
            justify-content: flex-end;
        }

        .reset-btn {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            color: #333;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            height: 40px;
        }

        .reset-btn:hover {
            background: #e9ecef;
            border-color: #bbb;
        }

        /* Статистика */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #0047AB;
            margin-bottom: 5px;
            font-family: 'Montserrat', sans-serif;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        /* Таблица заказов */
        .orders-table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
            margin-bottom: 40px;
            display: none;
            overflow-x: auto;
        }

        .table-header {
            display: grid;
            grid-template-columns: 100px 120px 170px 170px 170px 170px 200px 170px 170px 170px 220px;
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            color: #333;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: max-content;
        }

        .table-header-item {
            padding: 0 10px;
            text-align: left;
            white-space: nowrap;
        }

        .order-row {
            display: grid;
            grid-template-columns: 100px 120px 170px 170px 170px 170px 200px 170px 170px 170px 220px;
            padding: 20px 20px;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
            min-height: 80px;
        }

        .order-row:last-child {
            border-bottom: none;
        }

        .order-cell {
            padding: 0 10px;
            text-align: left;
        }

        .order-id {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .order-id-text {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        /* Стили для правильного переноса слов в таблице */
        .date-container {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .date-day {
            font-size: 14px;
            color: #333;
            line-height: 1.2;
        }

        .date-year {
            font-size: 12px;
            color: #666;
            line-height: 1.2;
        }

        .address-container {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .address-line {
            font-size: 14px;
            color: #333;
            line-height: 1.2;
        }

        .cargo-text {
            font-size: 14px;
            color: #333;
            line-height: 1.4;
        }

        .order-status-cell {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .order-status {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            width: fit-content;
        }

        .order-status.delivered {
            background: #d4edda;
            color: #155724;
        }

        .order-status.delivered .status-icon {
            color: #28a745;
            font-size: 10px;
        }

        .order-status.in-transit {
            background: #fff3cd;
            color: #856404;
        }

        .order-status.in-transit .status-icon {
            color: #ffc107;
            font-size: 10px;
        }

        .order-status.processing {
            background: #cce5ff;
            color: #004085;
        }

        .order-status.processing .status-icon {
            color: #007bff;
            font-size: 10px;
        }

        .order-status.new {
            background: #e2e3e5;
            color: #383d41;
        }

        .order-status.new .status-icon {
            color: #6c757d;
            font-size: 10px;
        }

        .order-status.confirmed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .order-status.confirmed .status-icon {
            color: #17a2b8;
            font-size: 10px;
        }

        .order-status.cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .order-status.cancelled .status-icon {
            color: #dc3545;
            font-size: 10px;
        }

        .order-price-cell {
            display: flex;
            flex-direction: column;
        }

        .order-price {
            font-size: 16px;
            font-weight: 700;
            color: #0047AB;
            font-family: 'Montserrat', sans-serif;
        }

        .order-actions-cell {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
        }

        .actions-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
            width: 100%;
        }

        .order-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        .view-btn, .track-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
            border: 1px solid;
            width: 100%;
            text-align: center;
        }

        .view-btn {
            background: white;
            border-color: #0047AB;
            color: #0047AB;
        }

        .view-btn:hover {
            background: #0047AB;
            color: white;
        }

        .track-btn {
            background: #0047AB;
            border-color: #0047AB;
            color: white;
        }

        .track-btn:hover {
            background: #003580;
            border-color: #003580;
        }

        /* Сообщение при отсутствии заказов */
        .no-orders-container {
            background: white;
            border-radius: 8px;
            padding: 60px 40px;
            text-align: center;
            border: 1px solid #e0e0e0;
            display: block;
        }

        .no-orders-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .no-orders-container h3 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
            font-family: 'Montserrat', sans-serif;
        }

        .no-orders-container p {
            color: #666;
            margin-bottom: 30px;
        }

        /* Стили для водителей и администраторов */
        .notification-count {
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            margin-left: 5px;
            display: inline-block;
            min-width: 18px;
            text-align: center;
        }

        .driver-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .driver-card h4 {
            margin: 0 0 10px 0;
            color: #0047AB;
        }

        .driver-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .driver-info-item {
            display: flex;
            flex-direction: column;
        }

        .driver-info-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 2px;
        }

        .driver-info-value {
            font-weight: 600;
            color: #333;
        }

        .driver-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Стили для модальных окон обработки заказов */
        .order-details-modal {
            max-width: 700px !important;
        }

        .order-detail-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .order-detail-label {
            font-weight: 600;
            color: #666;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .order-detail-value {
            color: #333;
            font-size: 16px;
        }

        /* Стили для статусов заказов */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .order-status.processing {
            background: #cce5ff;
            color: #004085;
        }

        .order-status.processing .status-icon {
            color: #007bff;
        }

        .order-status.confirmed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .order-status.confirmed .status-icon {
            color: #17a2b8;
        }

        .order-status.in-transit {
            background: #fff3cd;
            color: #856404;
        }

        .order-status.in-transit .status-icon {
            color: #ffc107;
        }

        .order-status.delivered {
            background: #d4edda;
            color: #155724;
        }

        .order-status.delivered .status-icon {
            color: #28a745;
        }

        .order-status.rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .order-status.rejected .status-icon {
            color: #dc3545;
        }

        .order-status.cancelled {
            background: #e2e3e5;
            color: #383d41;
        }

        .order-status.cancelled .status-icon {
            color: #6c757d;
        }

        /* Стили для кнопки увольнения */
        .resign-btn {
            background: #dc3545;
            color: white;
            border: 1px solid #dc3545;
        }

        .resign-btn:hover {
            background: #c82333;
            border-color: #bd2130;
        }

        /* Стили для модальных окон увольнения */
        .dismiss-reason {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        #driver-active-orders-list .table-header,
        #driver-active-orders-list .order-row {
            display: grid;
            grid-template-columns: 60px 150px 120px 200px 160px 180px;
            width: 100%;
            min-width: 100%;
            padding: 15px 20px;
            align-items: center;
        }

        #driver-history-list .table-header,
        #driver-history-list .order-row {
            display: grid;
            grid-template-columns: 80px 150px 120px 150px 120px;
        }

        #driver-history-list .orders-table-container {
            overflow-x: auto;
        }

        #admin-orders-list .order-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px; 
            width: 100%;
        }

        #admin-orders-list .view-btn,
        #admin-orders-list .track-btn {
            width: 100%;
            text-align: center;
            margin-top: 10px
        }

        /* Универсальные стили для всех таблиц администратора */
        #admin-orders-list .orders-table-container,
        #driver-applications-list .orders-table-container,
        #drivers-list-container .orders-table-container,
        #dismissal-history-list .orders-table-container {
            overflow-x: auto;
        }

        /* Заголовки и строки для всех таблиц */
        #admin-orders-list .table-header,
        #admin-orders-list .order-row,
        #driver-applications-list .table-header,
        #driver-applications-list .order-row,
        #drivers-list-container .table-header,
        #drivers-list-container .order-row,
        #dismissal-history-list .table-header,
        #dismissal-history-list .order-row {
            display: grid;
            width: max-content;
            min-width: 900px; /* Минимальная ширина для предотвращения сжатия */
        }

        /* Конкретные сетки для каждой таблицы */
        /* Управление заказами - 10 колонок */
        #admin-orders-list .table-header,
        #admin-orders-list .order-row {
            grid-template-columns: 150px 150px 140px 200px 200px 180px 120px 150px 120px 180px;
        }

        /* Заявки водителей - 9 колонок */
        #driver-applications-list .table-header,
        #driver-applications-list .order-row {
            grid-template-columns: 80px 160px 170px 170px 150px 100px 150px 130px 110px;
        }

        /* Водители - 8 колонок */
        #drivers-list-container .table-header,
        #drivers-list-container .order-row {
            grid-template-columns: 80px 120px 150px 160px 130px 150px 120px 120px;
        }

        /* История увольнений - 6 колонок */
        #dismissal-history-list .table-header,
        #dismissal-history-list .order-row {
            grid-template-columns: 180px 180px 180px 180px 180px 180px;
        }

        /* Исправление горизонтальной прокрутки для таблиц профиля */
        .profile-section .orders-table-container {
            overflow-x: auto;
            max-width: 100%;
        }

        /* Для вкладок администратора */
        #admin-orders-list .orders-table-container,
        #driver-applications-list .orders-table-container,
        #drivers-list-container .orders-table-container,
        #dismissal-history-list .orders-table-container {
            min-width: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        /* Адаптивность */
        @media (max-width: 1200px) {
            .table-header {
                grid-template-columns: 100px 120px 170px 170px 170px 170px 200px 170px 170px 220px;
            }

            .order-row {
                grid-template-columns: 100px 120px 170px 170px 170px 170px 200px 170px 170px 220px;
            }

            .profile-section .table-header,
            .profile-section .order-row {
                min-width: 100%;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            #admin-orders-list .table-header,
            #admin-orders-list .order-row {
                grid-template-columns: 60px 100px 120px 1.2fr 1.2fr 1fr 100px 90px 90px 120px;
            }

            #driver-applications-list .table-header,
            #driver-applications-list .order-row {
                grid-template-columns: 50px 100px 100px 100px 120px 70px 90px 90px 110px;
            }

            #drivers-list-container .table-header,
            #drivers-list-container .order-row {
                grid-template-columns: 50px 100px 100px 120px 70px 70px 90px 90px 110px;
            }

            .profile-section .orders-table-container {
                margin: 0 -20px;
                border-radius: 0;
                border-left: none;
                border-right: none;
            }

            .profile-section .table-header {
                display: none;
            }

            .profile-section .order-row {
                display: flex;
                flex-direction: column;
                padding: 20px;
                border-bottom: 2px solid #f0f0f0;
                gap: 15px;
            }

            .profile-section .order-cell {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                padding: 10px 0;
                border-bottom: 1px solid #f5f5f5;
            }

            .profile-section .order-cell:last-child {
                border-bottom: none;
                padding-bottom: 0;
            }

            .profile-section .order-cell:before {
                content: attr(data-label);
                font-weight: 600;
                color: #333;
                font-size: 14px;
                text-align: left;
                flex: 0 0 150px;
                margin-right: 20px;
            }

            .profile-section .order-actions-cell {
                flex-direction: column;
                align-items: stretch;
                padding-top: 15px;
                margin-top: 10px;
                border-top: 2px dashed #e0e0e0;
            }

            .profile-section .actions-container {
                width: 100%;
            }

            .profile-section .order-buttons {
                display: flex;
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }

            .profile-section .view-btn,
            .profile-section .track-btn {
                width: 100%;
                text-align: center;
                padding: 12px;
                font-size: 14px;
            }

            /* Специфичные стили для статусов */
            .profile-section .order-status {
                width: fit-content;
                margin-left: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Контейнер для уведомлений -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Шапка сайта -->
    <header>
        <div class="header-content">
            <div class="logo" onclick="showPage('main')">TransportCo</div>
            <nav>
                <a onclick="showPage('main')" class="active">Главная</a>
                <a onclick="showPage('about')">О компании</a>
                <a onclick="showPage('contacts')">Контакты</a>
            </nav>
            <div class="auth-buttons">
                <div id="unauth-buttons" style="display: flex; gap: 10px;">
                    <button class="btn-login" onclick="openLoginModal()">Вход</button>
                    <button class="btn-register" onclick="openRegisterModal()">Регистрация</button>
                </div>
                <div id="auth-user-buttons" style="display: none; gap: 10px;">
                    <button class="btn-order" onclick="showPage('profile')">Профиль</button>
                    <button class="btn-login" onclick="logout()">Выйти</button>
                </div>
                <button class="btn-order" onclick="showPage('order')">Заказать перевозку</button>
            </div>
        </div>
    </header>

    <!-- Основной контент -->
    <div id="content">
        <!-- Главная страница -->
        <div id="main-page" class="page-content active">
            <section class="call">
                <div class="call-content">
                    <h1>Надежная доставка грузов</h1>
                    <p>Профессиональная транспортная компания с опытом более 10 лет. Быстрая и безопасная доставка по всему региону.</p>
                    <button class="btn-order" onclick="showPage('order')">Заказать перевозку</button>
                </div>
            </section>

            <section class="features">
                <div class="features-content">
                    <h2>Почему выбирают нас</h2>
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">🚚</div>
                            <h3>Современный парк</h3>
                            <p>Новые автомобили с GPS-отслеживанием и кондиционированием</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">⏱️</div>
                            <h3>Быстрая доставка</h3>
                            <p>Оптимальные маршруты и своевременное прибытие гарантированы</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">🔒</div>
                            <h3>Безопасность</h3>
                            <p>Страховка груза и профессиональные водители с лицензиями</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">📍</div>
                            <h3>Везде доступны</h3>
                            <p>Доставка в любую точку региона и соседние области</p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="stats">
                <div class="stats-content">
                    <div class="stat-item">
                        <h3>10+</h3>
                        <p>Лет опыта</p>
                    </div>
                    <div class="stat-item">
                        <h3>500+</h3>
                        <p>Автомобилей</p>
                    </div>
                    <div class="stat-item">
                        <h3>50K+</h3>
                        <p>Доставок</p>
                    </div>
                    <div class="stat-item">
                        <h3>99%</h3>
                        <p>Довольных клиентов</p>
                    </div>
                </div>
            </section>
        </div>

        <!-- Страница "О компании" -->
        <div id="about-page" class="page-content">
            <div class="page-header">
                <div class="page-header-content">
                    <h1>О компании TransportCo</h1>
                </div>
            </div>

            <div class="container">
                <div class="about-section">
                    <h2>Наша история</h2>
                    <p>TransportCo - это профессиональная транспортная компания с более чем 10-летним опытом работы на рынке логистики и грузоперевозок. Мы специализируемся на надежной и быстрой доставке грузов по всей стране.</p>
                    <p>Наша компания имеет собственный парк из более 500 автомобилей различных типов и грузоподъемности, что позволяет нам предложить решение для любых задач перевозки.</p>
                </div>

                <div class="about-section">
                    <h2>История развития</h2>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-year">2015</div>
                            <div class="timeline-content">
                                <h4>Основание компании</h4>
                                <p>TransportCo была основана как небольшая семейная компания с 5 автомобилями</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">2017</div>
                            <div class="timeline-content">
                                <h4>Расширение парка</h4>
                                <p>Увеличение парка до 50 автомобилей и открытие филиалов в соседних городах</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">2019</div>
                            <div class="timeline-content">
                                <h4>Внедрение GPS-мониторинга</h4>
                                <p>Установка систем GPS-отслеживания на все автомобили для лучшего контроля</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">2021</div>
                            <div class="timeline-content">
                                <h4>Достижение 500 автомобилей</h4>
                                <p>Парк компании достигает 500 единиц техники, обслуживая более 50 000 доставок в год</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">2023</div>
                            <div class="timeline-content">
                                <h4>Запуск онлайн-платформы</h4>
                                <p>Открытие веб-сайта и мобильного приложения для удобного заказа услуг</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="about-section">
                    <h2>Наши ценности</h2>
                    <div class="values-grid">
                        <div class="value-card">
                            <h3>Надежность</h3>
                            <p>Мы гарантируем своевременную доставку и полную сохранность вашего груза</p>
                        </div>
                        <div class="value-card">
                            <h3>Профессионализм</h3>
                            <p>Наша команда состоит из опытных специалистов и водителей с лицензиями</p>
                        </div>
                        <div class="value-card">
                            <h3>Инновация</h3>
                            <p>Мы используем современные технологии для отслеживания и управления перевозками</p>
                        </div>
                        <div class="value-card">
                            <h3>Клиентоориентированность</h3>
                            <p>Ваши потребности - наш приоритет. Мы готовы найти решение для любой задачи</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Страница "Контакты" -->
        <div id="contacts-page" class="page-content">
            <div class="page-header">
                <div class="page-header-content">
                    <h1>Контакты</h1>
                </div>
            </div>

            <div class="container">
                <div class="upper-section">
                    <div class="contact-section">
                        <h2>Информация о компании</h2>
                        <div class="contact-item">
                            <h3>Адрес</h3>
                            <p>г. Кострома, ул. Титова, д.4</p>
                        </div>
                        <div class="contact-item">
                            <h3>Телефон</h3>
                            <p>+7 (812) 156-43-89</p>
                        </div>
                        <div class="contact-item">
                            <h3>Email</h3>
                            <p>info@transportco.ru</p>
                        </div>
                        <div class="contact-item">
                            <h3>Режим работы</h3>
                            <p>Пн-Пт: 5:00 - 20:00<br>Сб-Вс: Выходной</p>
                        </div>
                    </div>

                    <div class="map-container">
                        <div class="map-placeholder">
                            Здесь будет карта
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Страница "Профиль" -->
        <div id="profile-page" class="page-content">
            <div class="page-header">
                <div class="page-header-content">
                    <h1>Профиль</h1>
                    <p>Управление вашими данными и заказами</p>
                </div>
            </div>

            <div class="container">
                <!-- Навигация профиля -->
                <div class="profile-nav">
                    <button class="profile-nav-btn active" onclick="showProfileTab('data')">Данные</button>
                    <button class="profile-nav-btn" onclick="showProfileTab('orders')">Мои заказы</button>
                </div>

                <!-- Содержимое вкладок -->
                <div id="profile-tab-content" class="profile-tab-content">
                    <!-- Вкладка Данные -->
                    <div id="profile-data" class="profile-tab active">
                        <div class="profile-section">
                            <h2>Личные данные</h2>
                            <form id="profile-form" onsubmit="handleProfileSubmit(event)">
                                <div class="order-form-row">
                                    <div class="order-form-group">
                                        <label for="profile-first-name">Имя</label>
                                        <input type="text" id="profile-first-name" class="profile-field-readonly" placeholder="Иван" value="Иван" readonly>
                                    </div>
                                    <div class="order-form-group">
                                        <label for="profile-last-name">Фамилия</label>
                                        <input type="text" id="profile-last-name" class="profile-field-readonly" placeholder="Иванов" value="Иванов" readonly>
                                    </div>
                                </div>

                                <div class="order-form-row">
                                    <div class="order-form-group">
                                        <label for="profile-email">Email</label>
                                        <input type="email" id="profile-email" class="profile-field-readonly" placeholder="your@email.com" value="ivan@example.com" readonly>
                                    </div>
                                    <div class="order-form-group">
                                        <label for="profile-phone">Телефон</label>
                                        <input type="tel" id="profile-phone" class="profile-field-readonly" placeholder="+7 (912) 156-43-89" value="+7 (912) 156-43-89" readonly>
                                    </div>
                                </div>

                                <h3>Смена пароля</h3>
                                <div class="order-divider"></div>

                                <div class="order-form-group">
                                    <label for="profile-current-password">Текущий пароль</label>
                                    <input type="password" id="profile-current-password" placeholder="Текущий пароль">
                                </div>

                                <div class="order-form-row">
                                    <div class="order-form-group">
                                        <label for="profile-new-password">Новый пароль</label>
                                        <input type="password" id="profile-new-password" placeholder="Новый пароль">
                                    </div>
                                    <div class="order-form-group">
                                        <label for="profile-confirm-password">Подтвердите пароль</label>
                                        <input type="password" id="profile-confirm-password" placeholder="Подтвердите пароль">
                                    </div>
                                </div>

                                <button type="submit" class="order-submit-btn">Сохранить изменения</button>
                            </form>
                        </div>

                        <div class="profile-section">
                            <h2>Настройки уведомлений</h2>
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" id="notify-email" checked>
                                    Уведомления по Email
                                </label>
                            </div>
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" id="notify-sms" checked>
                                    Уведомления по SMS
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Вкладка Мои заказы -->
                    <div id="profile-orders" class="profile-tab" style="display: none;">
                        <!-- Статистика -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="profile-total-orders-count">0</div>
                                <div class="stat-label">Всего заказов</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-number" id="profile-processing-orders-count">0</div>
                                <div class="stat-label">В обработке</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-number" id="profile-in-transit-orders-count">0</div>
                                <div class="stat-label">В пути</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-number" id="profile-delivered-orders-count">0</div>
                                <div class="stat-label">Завершено</div>
                            </div>
                        </div>

                        <!-- Таблица заказов -->
                        <div id="profile-orders-table" class="orders-table-container" style="display: none;">
                            <div class="table-header">
                                <div class="table-header-item">№ ЗАКАЗА</div>
                                <div class="table-header-item">ДАТА ЗАЯВКИ</div>
                                <div class="table-header-item">ДАТА ОТПРАВЛЕНИЯ</div>
                                <div class="table-header-item">АДРЕС ОТПРАВЛЕНИЯ</div>
                                <div class="table-header-item">АДРЕС ДОСТАВКИ</div>
                                <div class="table-header-item">ГРУЗ</div>
                                <div class="table-header-item">КАТЕГОРИЯ</div>
                                <div class="table-header-item">СТАТУС</div>
                                <div class="table-header-item">РАССТОЯНИЕ</div>
                                <div class="table-header-item">ЦЕНА</div>
                                <div class="table-header-item">ДЕЙСТВИЯ</div>
                            </div>
                        </div>

                        <!-- Сообщение при отсутствии заказов -->
                        <div id="profile-no-orders-message" class="no-orders-container" style="display: block;">
                            <div class="no-orders-icon">📦</div>
                            <h3>Заказов нет</h3>
                            <p>У вас пока нет оформленных заказов</p>
                            <button class="btn-order" onclick="showPage('order')">Сделать первый заказ</button>
                        </div>
                    </div>
                </div>

                <!-- Вкладка "Стать водителем" для пользователей -->
                <div id="profile-become-driver" class="profile-tab" style="display: none;">
                    <div class="profile-section">
                        <h2>Подать заявку на роль водителя</h2>
                        <p>Заполните форму ниже, чтобы стать водителем нашей компании. Мы рассмотрим вашу заявку в течение 3 рабочих дней.</p>

                        <form id="driver-application-form" onsubmit="submitDriverApplication(event)">
                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label for="driver-license" class="required">Номер водительского удостоверения</label>
                                    <input type="text" id="driver-license" placeholder="1234567890" required>
                                </div>
                                <div class="order-form-group">
                                    <label for="driver-experience" class="required">Опыт вождения (лет)</label>
                                    <input type="number" id="driver-experience" min="1" max="50" placeholder="5" required>
                                </div>
                            </div>

                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label for="car-model" class="required">Модель автомобиля</label>
                                    <input type="text" id="car-model" placeholder="Volvo FH16" required>
                                </div>
                                <div class="order-form-group">
                                    <label for="car-number" class="required">Госномер</label>
                                    <input type="text" id="car-number" placeholder="A123BC98" required>
                                </div>
                            </div>

                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label for="max-weight" class="required">Макс. грузоподъемность (кг)</label>
                                    <input type="number" id="max-weight" min="1000" max="50000" placeholder="20000" required>
                                </div>
                                <div class="order-form-group">
                                    <label for="car-type">Тип кузова</label>
                                    <select id="car-type">
                                        <option value="tent">Тент</option>
                                        <option value="refrigerator">Рефрижератор</option>
                                        <option value="container">Контейнер</option>
                                        <option value="tank">Цистерна</option>
                                        <option value="flatbed">Платформа</option>
                                    </select>
                                </div>
                            </div>

                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" id="agree-driver-terms" required>
                                    Я согласен с условиями работы водителя и подтверждаю достоверность предоставленных данных
                                </label>
                            </div>

                            <button type="submit" class="order-submit-btn">Подать заявку</button>
                        </form>
                    </div>

                    <div class="profile-section" id="driver-application-status" style="display: none;">
                        <h2>Статус заявки</h2>
                        <div id="application-status-content"></div>
                    </div>
                </div>

                <!-- Вкладка "Мои заказы" для водителей -->
                <div id="profile-driver-active-orders" class="profile-tab" style="display: none;">
                    <div class="profile-section">
                        <h2>Мои активные заказы</h2>

                        <div id="driver-active-orders-list" class="orders-table-container">
                            <!-- Активные заказы водителя -->
                        </div>

                        <div id="driver-no-active-orders" class="no-orders-container" style="display: block;">
                            <div class="no-orders-icon">🚚</div>
                            <h3>Нет активных заказов</h3>
                            <p>У вас нет заказов в работе</p>
                        </div>
                    </div>
                </div>

                <!-- Вкладка "История доставок" для водителей -->
                <div id="profile-driver-history" class="profile-tab" style="display: none;">
                    <div class="profile-section">
                        <h2>История доставок</h2>

                        <div id="driver-history-list" class="orders-table-container">
                            <!-- История доставок -->
                        </div>

                        <div id="driver-no-history" class="no-orders-container" style="display: block;">
                            <div class="no-orders-icon">📊</div>
                            <h3>История пуста</h3>
                            <p>У вас еще нет завершенных доставок</p>
                        </div>
                    </div>
                </div>

                <!-- Вкладка "Статистика" для водителей -->
                <div id="profile-driver-stats" class="profile-tab" style="display: none;">
                    <div class="profile-section">
                        <h2>Моя статистика</h2>

                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="driver-total-deliveries">0</div>
                                <div class="stat-label">Всего доставок</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-number" id="driver-earnings">0</div>
                                <div class="stat-label">Заработок (₽)</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-number" id="driver-avg-delivery-time">0</div>
                                <div class="stat-label">Ср. время доставки (ч)</div>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h3>Данные автомобиля</h3>
                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label>Модель:</label>
                                    <input type="text" id="driver-car-model" class="profile-field-readonly" readonly>
                                </div>
                                <div class="order-form-group">
                                    <label>Госномер:</label>
                                    <input type="text" id="driver-car-number" class="profile-field-readonly" readonly>
                                </div>
                            </div>

                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label>Макс. грузоподъемность:</label>
                                    <input type="text" id="driver-max-weight" class="profile-field-readonly" readonly>
                                </div>
                                <div class="order-form-group">
                                    <label>Статус:</label>
                                    <input type="text" id="driver-status" class="profile-field-readonly" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Вкладка "Управление заказами" для администратора -->
                <div id="profile-admin-orders" class="profile-tab" style="display: none;">
                    <div class="profile-section">
                        <h2>Управление заказами</h2>
                        <div id="admin-orders-list" class="orders-table-container" style="display: block;">
                            <div class="table-header">
                                <div class="table-header-item">НОМЕР ЗАКАЗА</div>
                                <div class="table-header-item">КЛИЕНТ</div>
                                <div class="table-header-item">ТЕЛЕФОН</div>
                                <div class="table-header-item">МАРШРУТ</div>
                                <div class="table-header-item">ГРУЗ</div>
                                <div class="table-header-item">СТАТУС</div>
                                <div class="table-header-item">ВОДИТЕЛЬ</div>
                                <div class="table-header-item">ЦЕНА</div>
                                <div class="table-header-item">ДАТА</div>
                                <div class="table-header-item">ДЕЙСТВИЯ</div>
                            </div>
                            <div id="admin-orders-body"></div>
                        </div>
                    </div>
                </div>

                <!-- Вкладка "Заявки водителей" для администратора -->
                <div id="profile-driver-applications" class="profile-tab" style="display: none;">
                    <div class="profile-section">
                        <h2>Заявки водителей</h2>

                        <div id="driver-applications-list" class="orders-table-container" style="display: block;">
                            <div class="table-header">
                                <div class="table-header-item">ID</div>
                                <div class="table-header-item">ФИО</div>
                                <div class="table-header-item">ТЕЛЕФОН</div>
                                <div class="table-header-item">ВОД. УДОСТ.</div>
                                <div class="table-header-item">АВТОМОБИЛЬ</div>
                                <div class="table-header-item">ОПЫТ</div>
                                <div class="table-header-item">СТАТУС</div>
                                <div class="table-header-item">ДАТА</div>
                                <div class="table-header-item">ДЕЙСТВИЯ</div>
                            </div>
                            <div id="driver-applications-body"></div>
                        </div>
                    </div>
                </div>

                <!-- Вкладка "Водители" для администратора -->
                <div id="profile-drivers-list" class="profile-tab" style="display: none;">
                    <div class="profile-section">
                        <h2>Список водителей</h2>
                        <div id="drivers-list-container" class="orders-table-container" style="display: block;">
                            <div class="table-header">
                                <div class="table-header-item">ID</div>
                                <div class="table-header-item">ФИО</div>
                                <div class="table-header-item">ТЕЛЕФОН</div>
                                <div class="table-header-item">АВТОМОБИЛЬ</div>
                                <div class="table-header-item">ДОСТАВОК</div>
                                <div class="table-header-item">СТАТУС</div>
                                <div class="table-header-item">ДАТА НАЙМА</div>
                                <div class="table-header-item">ДЕЙСТВИЯ</div>
                            </div>
                            <div id="drivers-list-body"></div>
                        </div>
                    </div>
                </div>

                <!-- Вкладка "История увольнений" для администратора -->
                <div id="profile-resignation-history" class="profile-tab" style="display: none;">
                    <div class="profile-section">
                        <h2>История увольнений водителей</h2>
                        <div id="dismissal-history-list" class="orders-table-container" style="display: block;">
                            <div class="table-header">
                                <div class="table-header-item">ВОДИТЕЛЬ</div>
                                <div class="table-header-item">ТИП</div>
                                <div class="table-header-item">ПРИЧИНА</div>
                                <div class="table-header-item">ЗАКАЗОВ ЗАДЕТО</div>
                                <div class="table-header-item">ДАТА</div>
                                <div class="table-header-item">ДЕЙСТВИЯ</div>
                            </div>
                            <div id="dismissal-history-body"></div>
                        </div>

                        <div id="no-dismissal-history" class="no-orders-container" style="display: none;">
                            <div class="no-orders-icon">📋</div>
                            <h3>История увольнений пуста</h3>
                            <p>Увольнений водителей еще не было</p>
                        </div>
                    </div>
                </div>

                <!-- Вкладка "Статистика" для администратора -->
                <div id="profile-admin-stats" class="profile-tab" style="display: none;">
                    <div class="profile-section">
                        <h2>Статистика компании</h2>

                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="admin-total-orders">0</div>
                                <div class="stat-label">Всего заказов</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-number" id="admin-today-orders">0</div>
                                <div class="stat-label">Заказов сегодня</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-number" id="admin-active-drivers">0</div>
                                <div class="stat-label">Активных водителей</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-number" id="admin-total-revenue">0</div>
                                <div class="stat-label">Выручка (₽)</div>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h3>Статистика по статусам заказов</h3>
                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label>Новых:</label>
                                    <input type="text" id="stats-new-orders" class="profile-field-readonly" readonly>
                                </div>
                                <div class="order-form-group">
                                    <label>Подтвержденных:</label>
                                    <input type="text" id="stats-confirmed-orders" class="profile-field-readonly" readonly>
                                </div>
                                <div class="order-form-group">
                                    <label>В пути:</label>
                                    <input type="text" id="stats-transit-orders" class="profile-field-readonly" readonly>
                                </div>
                                <div class="order-form-group">
                                    <label>Доставленных:</label>
                                    <input type="text" id="stats-delivered-orders" class="profile-field-readonly" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Страница "Заказ перевозки" -->
        <div id="order-page" class="page-content">
            <div class="page-header">
                <div class="page-header-content">
                    <h1>Заказать перевозку</h1>
                </div>
            </div>

            <div class="order-container">
                <form id="orderForm" onsubmit="handleOrderSubmit(event)">
                    <!-- Информация об отправителе -->
                    <div class="form-section">
                        <h2>Информация об отправителе</h2>

                        <div class="order-divider"></div>

                        <div class="order-form-row">
                            <div class="order-form-group">
                                <label for="sender-name" class="required">Ваше имя</label>
                                <input type="text" id="sender-name" placeholder="Иван Иванов" required>
                                <div class="order-error-message" id="sender-name-error"></div>
                            </div>

                            <div class="order-form-group">
                                <label for="sender-phone" class="required">Телефон</label>
                                <input type="tel" id="sender-phone" placeholder="+7 (912) 156-43-89" required>
                                <div class="order-error-message" id="sender-phone-error"></div>
                            </div>
                        </div>

                        <div class="order-form-group">
                            <label for="sender-email">Email</label>
                            <input type="email" id="sender-email" placeholder="your@email.com">
                            <div class="order-error-message" id="sender-email-error"></div>
                        </div>
                    </div>

                    <!-- Информация о грузе -->
                    <div class="form-section">
                        <h2>Информация о грузе</h2>

                        <div class="order-divider"></div>

                        <div class="order-form-group">
                            <label for="cargo-description" class="required">Описание груза</label>
                            <textarea id="cargo-description" placeholder="Опишите груз, его характеристики и особенности упаковки" rows="3" required></textarea>
                            <div class="order-error-message" id="cargo-description-error"></div>
                        </div>

                        <!-- Добавлено поле для категории товаров -->
                        <div class="order-form-group">
                            <label for="product-category" class="required">Категория товара</label>
                            <select id="product-category" required>
                                <option value="">Выберите категорию</option>
                                <option value="electronics">Электроника</option>
                                <option value="clothing">Одежда и обувь</option>
                                <option value="furniture">Мебель</option>
                                <option value="food">Продукты питания</option>
                                <option value="building">Строительные материалы</option>
                                <option value="auto">Автозапчасти</option>
                                <option value="industrial">Промышленное оборудование</option>
                                <option value="chemicals">Химические вещества</option>
                                <option value="documents">Документы</option>
                                <option value="other">Другое</option>
                            </select>
                            <div class="order-error-message" id="product-category-error"></div>
                        </div>

                        <div class="order-form-group">
                            <label for="cargo-weight" class="required">Вес груза</label>
                            <div class="weight-input">
                                <input type="number" id="cargo-weight" placeholder="1" required>
                                <span>кг</span>
                            </div>
                            <div class="order-error-message" id="cargo-weight-error"></div>
                        </div>

                        <div class="order-form-group">
                            <label for="cargo-volume" class="required">Объем</label>
                            <div class="volume-input">
                                <input type="number" id="cargo-volume" placeholder="1" required>
                                <span>м³</span>
                            </div>
                            <div class="order-error-message" id="cargo-volume-error"></div>
                        </div>

                        <div class="order-form-row">
                            <div class="order-form-group">
                                <label for="cargo-type" class="required">Тип груза</label>
                                <select id="cargo-type" required>
                                    <option value="">Выберите тип груза</option>
                                    <option value="general">Общий груз</option>
                                    <option value="fragile">Хрупкий груз</option>
                                    <option value="dangerous">Опасный груз</option>
                                    <option value="perishable">Скоропортящийся груз</option>
                                </select>
                                <div class="order-error-message" id="cargo-type-error"></div>
                            </div>

                            <div class="order-form-group">
                                <label for="shipping-date" class="required">Дата отправки</label>
                                <input type="date" id="shipping-date" required>
                                <div class="order-error-message" id="shipping-date-error"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Адреса доставки -->
                    <div class="form-section">
                        <h2>Адреса доставки</h2>

                        <div class="order-divider"></div>

                        <div class="order-form-group">
                            <label for="pickup-address" class="required">Адрес отправки</label>
                            <input type="text" id="pickup-address" placeholder="Кострома, ул. Ленина, д. 10" required>
                            <div class="order-error-message" id="pickup-address-error"></div>
                        </div>

                        <div class="order-form-group">
                            <label for="delivery-address" class="required">Адрес доставки</label>
                            <input type="text" id="delivery-address" placeholder="Москва, ул. Арбат, д. 5" required>
                            <div class="order-error-message" id="delivery-address-error"></div>
                        </div>

                        <!-- Скрытое поле для расстояния -->
                        <div class="order-form-group" style="display: none;">
                            <input type="hidden" id="distance-km" value="0">
                        </div>
                    </div>

                    <!-- Дополнительные услуги -->
                    <div class="form-section">
                        <h2>Дополнительные услуги</h2>

                        <div class="order-divider"></div>

                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="insurance">
                                Страховка груза (1% от стоимости)
                            </label>
                        </div>

                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="packaging">
                                Профессиональная упаковка (+2000 ₽)
                            </label>
                        </div>
                    </div>

                    <!-- Комментарии -->
                    <div class="form-section">
                        <h2>Комментарии</h2>

                        <div class="order-form-group">
                            <textarea id="comments" placeholder="Дополнительная информация для менеджера..." rows="4"></textarea>
                        </div>
                    </div>

                    <button type="submit" class="order-submit-btn">Оформить заказ</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Подвал сайта -->
    <footer>
        <p>&copy; 2025 TransportCo. Все права защищены.</p>
    </footer>

    <!-- Модальное окно авторизации -->
    <div id="loginModal" class="modal">
        <div class="auth-container">
            <div class="auth-header">
                <button class="close-auth-btn" onclick="closeLoginModal()">×</button>
                <div class="auth-logo">TransportCo</div>
                <div class="auth-subtitle">Вход в аккаунт</div>
            </div>

            <div class="auth-form-container">
                <div class="auth-input-group">
                    <label for="auth-login">Телефон или Email</label>
                    <input class="auth-input" type="text" id="auth-login" placeholder="+7 930 913 78 79 или your@email.com">
                    <div class="error-message" id="auth-login-error"></div>
                </div>

                <div class="auth-input-group">
                    <label for="auth-password">Пароль</label>
                    <input class="auth-input" type="password" id="auth-password" placeholder="......">
                    <div class="error-message" id="auth-password-error"></div>
                </div>

                <div class="auth-options-row">
                    <label class="auth-checkbox-container">
                        <input type="checkbox" id="auth-rememberMe">
                        <span class="auth-custom-checkbox">
                            <span class="auth-checkmark"></span>
                        </span>
                        <span class="auth-checkbox-text">Запомнить меня</span>
                    </label>
                    <a class="auth-forgot-password" onclick="openForgotPasswordModal()">Забыли пароль?</a>
                </div>

                <button class="auth-btn" onclick="handleLogin()">Войти</button>

                <div class="auth-link">
                    Нет аккаунта? <a onclick="switchToRegister()">Зарегистрироваться</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно регистрации -->
    <div id="registerModal" class="modal">
        <div class="auth-container">
            <div class="auth-header">
                <button class="close-auth-btn" onclick="closeRegisterModal()">×</button>
                <div class="auth-logo">TransportCo</div>
                <div class="auth-subtitle">Создание аккаунта</div>
            </div>

            <div class="auth-form-container">
                <div class="auth-row">
                    <div class="auth-input-group">
                        <label for="reg-firstName">Имя</label>
                        <input class="auth-input" type="text" id="reg-firstName" placeholder="Иван">
                        <div class="error-message" id="reg-firstName-error"></div>
                    </div>
                    <div class="auth-input-group">
                        <label for="reg-lastName">Фамилия</label>
                        <input class="auth-input" type="text" id="reg-lastName" placeholder="Иванов">
                        <div class="error-message" id="reg-lastName-error"></div>
                    </div>
                </div>

                <div class="auth-input-group">
                    <label for="reg-email">Email</label>
                    <input class="auth-input" type="email" id="reg-email" placeholder="your@email.com">
                    <div class="error-message" id="reg-email-error"></div>
                </div>

                <div class="auth-input-group">
                    <label for="reg-phone">Телефон</label>
                    <input class="auth-input" type="tel" id="reg-phone" placeholder="+7 (812) 156-43-89">
                    <div class="error-message" id="reg-phone-error"></div>
                </div>

                <div class="auth-input-group">
                    <label for="reg-password">Пароль</label>
                    <input class="auth-input" type="password" id="reg-password" placeholder="......">
                    <div class="error-message" id="reg-password-error"></div>
                </div>

                <div class="auth-input-group">
                    <label for="reg-confirmPassword">Подтвердить пароль</label>
                    <input class="auth-input" type="password" id="reg-confirmPassword" placeholder="......">
                    <div class="error-message" id="reg-confirmPassword-error"></div>
                </div>

                <label class="auth-checkbox-container">
                    <input type="checkbox" id="reg-agreeTerms">
                    <span class="auth-custom-checkbox">
                        <span class="auth-checkmark"></span>
                    </span>
                    <span class="auth-checkbox-text">Я согласен с условиями использования и политикой конфиденциальности.</span>
                </label>

                <button class="auth-btn register-btn" onclick="handleRegister()">Зарегистрироваться</button>

                <div class="auth-link">
                    Уже есть аккаунт? <a onclick="switchToLogin()">Войти</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно подтверждения телефона при регистрации -->
    <div id="confirmRegisterCodeModal" class="modal">
        <div class="auth-container">
            <div class="auth-header">
                <button class="close-auth-btn" onclick="closeConfirmRegisterCodeModal()">×</button>
                <div class="auth-logo">TransportCo</div>
                <div class="auth-subtitle">Подтвердите телефон</div>
            </div>

            <div class="auth-form-container">
                <div class="sms-code-info">
                    На ваш телефон было отправлено<br>CМС-сообщение с кодом подтверждения.
                </div>

                <div class="auth-input-group">
                    <label for="reg-sms-code" style="text-align: center; display: block;">КОД ИЗ СМС</label>
                    <div class="sms-code-input">
                        <input type="text" id="reg-sms-code-1" maxlength="1" oninput="moveToNextRegister(1, event)">
                        <input type="text" id="reg-sms-code-2" maxlength="1" oninput="moveToNextRegister(2, event)">
                        <input type="text" id="reg-sms-code-3" maxlength="1" oninput="moveToNextRegister(3, event)">
                        <input type="text" id="reg-sms-code-4" maxlength="1" oninput="moveToNextRegister(4, event)">
                    </div>
                </div>

                <div class="sms-timer" id="reg-sms-timer">
                    Пожалуйста подождите... 59 сек
                </div>

                <div class="divider"></div>

                <div class="resend-code disabled" id="reg-resend-code">
                    Не приходит код? <a onclick="resendRegisterCode()">Отправить снова</a>
                </div>

                <div class="confirm-code-buttons">
                    <button class="continue-btn" onclick="verifyRegisterCode()">Подтвердить регистрацию</button>
                    <button class="back-btn" onclick="backToRegister()">Назад</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно восстановления пароля (шаг 1) -->
    <div id="forgotPasswordModal" class="modal">
        <div class="auth-container">
            <div class="auth-header">
                <button class="close-auth-btn" onclick="closeForgotPasswordModal()">×</button>
                <div class="auth-logo">TransportCo</div>
                <div class="auth-subtitle">Восстановление пароля</div>
            </div>

            <div class="auth-form-container">
                <div class="forgot-password-info">
                    Введите номер мобильного телефона или e-mail, который вы использовали при регистрации
                </div>

                <div class="auth-input-group">
                    <label for="recovery-contact">ТЕЛЕФОН ИЛИ E-MAIL</label>
                    <input class="auth-input" type="text" id="recovery-contact" placeholder="Номер мобильного телефона или e-mail*" required>
                </div>

                <div class="forgot-password-buttons">
                    <button class="back-btn" onclick="closeForgotPasswordModal()">Назад</button>
                    <button class="recovery-btn" onclick="sendRecoveryCode()">Восстановить пароль</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно подтверждения телефона (шаг 2) -->
    <div id="confirmCodeModal" class="modal">
        <div class="auth-container">
            <div class="auth-header">
                <button class="close-auth-btn" onclick="closeConfirmCodeModal()">×</button>
                <div class="auth-logo">TransportCo</div>
                <div class="auth-subtitle">Подтвердите телефон</div>
            </div>

            <div class="auth-form-container">
                <div class="sms-code-info">
                    На ваш телефон было отправлено<br>CМС-сообщение с кодом подтверждения.
                </div>

                <div class="auth-input-group">
                    <label for="sms-code" style="text-align: center; display: block;">КОД ИЗ СМС</label>
                    <div class="sms-code-input">
                        <input type="text" id="sms-code-1" maxlength="1" oninput="moveToNext(1, event)">
                        <input type="text" id="sms-code-2" maxlength="1" oninput="moveToNext(2, event)">
                        <input type="text" id="sms-code-3" maxlength="1" oninput="moveToNext(3, event)">
                        <input type="text" id="sms-code-4" maxlength="1" oninput="moveToNext(4, event)">
                    </div>
                </div>

                <div class="sms-timer" id="sms-timer">
                    Пожалуйста подождите... 59 сек
                </div>

                <div class="divider"></div>

                <div class="resend-code disabled" id="resend-code">
                    Не приходит код? <a onclick="resendCode()">Отправить снова</a>
                </div>

                <div class="confirm-code-buttons">
                    <button class="continue-btn" onclick="verifyCode()">Продолжить</button>
                    <button class="back-btn" onclick="backToForgotPassword()">Назад</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Локальное хранилище для пользователей (имитация базы данных)
        let users = JSON.parse(localStorage.getItem('transportco_users')) || [
            {
                id: 1,
                email: "test@example.com",
                phone: "+79123456789",
                password: "password123",
                firstName: "Иван",
                lastName: "Иванов",
                verified: true
            },
            {
                id: 2,
                email: "admin@transportco.ru",
                phone: "+79123456780",
                password: "admin123",
                firstName: "Александр",
                lastName: "Петров",
                verified: true,
                isAdmin: true  // Флаг администратора
            },
            {
                id: 3,
                email: "driver@transportco.ru",
                phone: "+79123456781",
                password: "driver123",
                firstName: "Сергей",
                lastName: "Сидоров",
                verified: true,
                isDriver: true,  // Флаг водителя
                licenseNumber: "78AA123456",
                experience: 5,
                carModel: "Volvo FH16",
                carNumber: "A123BC98",
                maxWeight: 20000,
                carType: "tent",
                completedDeliveries: 45,
                hireDate: "2023-05-15",
                status: "active",
                totalEarnings: 450000
            }
        ];

        // Текущий пользователь
        let currentUser = JSON.parse(localStorage.getItem('transportco_currentUser')) || null;

        // Заказы (имитация базы данных)
        let orders = JSON.parse(localStorage.getItem('transportco_orders')) || [];

        // Заявки на роль водителя
        let driverApplications = JSON.parse(localStorage.getItem('transportco_driver_applications')) || [];

        // Водители
        let drivers = JSON.parse(localStorage.getItem('transportco_drivers')) || [];

        // Уведомления
        let notifications = JSON.parse(localStorage.getItem('transportco_notifications')) || [];

        // Администраторы (пользователи с флагом isAdmin)
        let admins = users.filter(user => user.isAdmin);

        // Константы статусов заказов
        const ORDER_STATUSES = {
            // Статусы для клиента
            CLIENT: {
                PROCESSING: 'processing',       // В обработке
                CONFIRMED: 'confirmed',         // Подтвержден
                IN_TRANSIT: 'in_transit',       // В пути
                DELIVERED: 'delivered',         // Завершен
                REJECTED: 'rejected',           // Отклонен
                CANCELLED: 'cancelled'          // Отменен
            },
            // Статусы для администратора
            ADMIN: {
                NEW: 'new',                     // Новый
                CONFIRMED: 'confirmed',         // Подтвержден
                IN_TRANSIT: 'in_transit',       // В пути
                DELIVERED: 'delivered',         // Завершен
                REJECTED: 'rejected',           // Отклонен
                CANCELLED_BY_CLIENT: 'cancelled_by_client' // Отменен клиентом
            }
        };

        // Функция для получения текста статуса в зависимости от роли пользователя
        function getStatusText(status, isAdmin = false) {
            if (isAdmin) {
                switch(status) {
                    case ORDER_STATUSES.ADMIN.NEW: return 'Новый';
                    case ORDER_STATUSES.ADMIN.CONFIRMED: return 'Подтвержден';
                    case ORDER_STATUSES.ADMIN.IN_TRANSIT: return 'В пути';
                    case ORDER_STATUSES.ADMIN.DELIVERED: return 'Завершен';
                    case ORDER_STATUSES.ADMIN.REJECTED: return 'Отклонен';
                    case ORDER_STATUSES.ADMIN.CANCELLED_BY_CLIENT: return 'Отменен клиентом';
                    default: return status;
                }
            } else {
                switch(status) {
                    case ORDER_STATUSES.CLIENT.PROCESSING: 
                    case ORDER_STATUSES.ADMIN.NEW:
                        return 'В обработке';
                    case ORDER_STATUSES.CLIENT.CONFIRMED: 
                    case ORDER_STATUSES.ADMIN.CONFIRMED:
                        return 'Подтвержден';
                    case ORDER_STATUSES.CLIENT.IN_TRANSIT: 
                    case ORDER_STATUSES.ADMIN.IN_TRANSIT:
                        return 'В пути';
                    case ORDER_STATUSES.CLIENT.DELIVERED: 
                    case ORDER_STATUSES.ADMIN.DELIVERED:
                        return 'Завершен';
                    case ORDER_STATUSES.CLIENT.REJECTED: 
                    case ORDER_STATUSES.ADMIN.REJECTED:
                        return 'Отклонен';
                    case ORDER_STATUSES.CLIENT.CANCELLED: 
                    case ORDER_STATUSES.ADMIN.CANCELLED_BY_CLIENT:
                        return 'Отменен';
                    default: return status;
                }
            }
        }

        // Функция для получения CSS класса статуса
        function getStatusClass(status) {
            switch(status) {
                case ORDER_STATUSES.CLIENT.PROCESSING:
                case ORDER_STATUSES.ADMIN.NEW:
                    return 'processing';
                case ORDER_STATUSES.CLIENT.CONFIRMED:
                case ORDER_STATUSES.ADMIN.CONFIRMED:
                    return 'confirmed';
                case ORDER_STATUSES.CLIENT.IN_TRANSIT:
                case ORDER_STATUSES.ADMIN.IN_TRANSIT:
                    return 'in-transit';
                case ORDER_STATUSES.CLIENT.DELIVERED:
                case ORDER_STATUSES.ADMIN.DELIVERED:
                    return 'delivered';
                case ORDER_STATUSES.CLIENT.REJECTED:
                case ORDER_STATUSES.ADMIN.REJECTED:
                    return 'rejected';
                case ORDER_STATUSES.CLIENT.CANCELLED:
                case ORDER_STATUSES.ADMIN.CANCELLED_BY_CLIENT:
                    return 'cancelled';
                default:
                    return 'new';
            }
        }

        // Функция преобразования статуса между ролями
        function convertStatusForRole(status, targetRole) {
            // Преобразование статуса "Новый" администратора в "В обработке" для клиента
            if (status === ORDER_STATUSES.ADMIN.NEW && targetRole === 'client') {
                return ORDER_STATUSES.CLIENT.PROCESSING;
            }
            // Преобразование статуса "Отменен клиентом" администратора в "Отменен" для клиента
            else if (status === ORDER_STATUSES.ADMIN.CANCELLED_BY_CLIENT && targetRole === 'client') {
                return ORDER_STATUSES.CLIENT.CANCELLED;
            }
            // Преобразование статуса "В обработке" клиента в "Новый" для администратора
            else if (status === ORDER_STATUSES.CLIENT.PROCESSING && targetRole === 'admin') {
                return ORDER_STATUSES.ADMIN.NEW;
            }
            // Преобразование статуса "Отменен" клиента в "Отменен клиентом" для администратора
            else if (status === ORDER_STATUSES.CLIENT.CANCELLED && targetRole === 'admin') {
                return ORDER_STATUSES.ADMIN.CANCELLED_BY_CLIENT;
            }
            // Для остальных статусов преобразование 1:1
            else if (status.includes('confirmed') || status.includes('in_transit') || 
                    status.includes('delivered') || status.includes('rejected')) {
                return status;
            }
            
            return status; // На случай неизвестного статуса
        }

        function getCategoryName(categoryCode) {
            const categories = {
                'electronics': 'Электроника',
                'clothing': 'Одежда и обувь',
                'furniture': 'Мебель',
                'food': 'Продукты питания',
                'building': 'Строительные материалы',
                'auto': 'Автозапчасти',
                'industrial': 'Промышленное оборудование',
                'chemicals': 'Химические вещества',
                'documents': 'Документы',
                'other': 'Другое'
            };
            
            return categories[categoryCode] || categoryCode;
        }

        // Функция для преобразования типа кузова
        function getCarTypeName(carType) {
            const carTypes = {
                'tent': 'Тент',
                'refrigerator': 'Рефрижератор',
                'container': 'Контейнер',
                'tank': 'Цистерна',
                'flatbed': 'Платформа'
            };
            return carTypes[carType] || carType;
        }

        function getCargoTypeName(cargoTypeCode) {
            const cargoTypes = {
                'general': 'Общий груз',
                'fragile': 'Хрупкий груз',
                'dangerous': 'Опасный груз',
                'perishable': 'Скоропортящийся груз'
            };
            return cargoTypes[cargoTypeCode] || cargoTypeCode;
        }

        // База расстояний между городами (в км)
        const cityDistances = {
            // Центральный регион
            'Москва': {
                'Санкт-Петербург': 714,
                'Кострома': 346,
                'Ярославль': 274,
                'Владимир': 194,
                'Казань': 807,
                'Нижний Новгород': 416,
                'Екатеринбург': 1745,
                'Новосибирск': 3350,
                'Сочи': 1584
            },
            'Санкт-Петербург': {
                'Москва': 710,
                'Кострома': 860,
                'Ярославль': 800,
                'Великий Новгород': 180,
                'Псков': 280,
                'Мурманск': 1400
            },
            'Кострома': {
                'Москва': 340,
                'Санкт-Петербург': 860,
                'Ярославль': 85,
                'Иваново': 110,
                'Нижний Новгород': 330,
                'Вологда': 220
            },
            'Ярославль': {
                'Москва': 280,
                'Санкт-Петербург': 800,
                'Кострома': 85,
                'Вологда': 200,
                'Рыбинск': 75
            }
        };

        // Функция для расчета расстояния между городами
        function calculateDistance(city1, city2) {
            if (!city1 || !city2) return 100; // Значение по умолчанию

            const normalizedCity1 = normalizeCityName(city1);
            const normalizedCity2 = normalizeCityName(city2);

            if (normalizedCity1 === normalizedCity2) {
                return 10; // Внутри города
            }

            // Проверяем в обе стороны
            if (cityDistances[normalizedCity1] && cityDistances[normalizedCity1][normalizedCity2]) {
                return cityDistances[normalizedCity1][normalizedCity2];
            }

            if (cityDistances[normalizedCity2] && cityDistances[normalizedCity2][normalizedCity1]) {
                return cityDistances[normalizedCity2][normalizedCity1];
            }

            // Если города не найдены в базе, используем эмпирическую формулу
            return calculateEstimatedDistance(normalizedCity1, normalizedCity2);
        }

        // Функция для нормализации названия города
        function normalizeCityName(city) {
            if (!city) return '';

            // Удаляем лишние пробелы, приводим к нижнему регистру
            const normalized = city.trim().toLowerCase();

            // Ищем соответствие в базе городов
            const knownCities = Object.keys(cityDistances);
            const found = knownCities.find(knownCity =>
                knownCity.toLowerCase().includes(normalized) ||
                normalized.includes(knownCity.toLowerCase())
            );

            return found || city.trim();
        }

        // Временные данные для регистрации
        let tempRegistrationData = null;

        // Переменная для запоминания страницы после авторизации
        let pendingPageAfterLogin = null;

        // Система уведомлений
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationContainer');

            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;

            notification.innerHTML = `
                <div class="notification-content">${message}</div>
                <button class="notification-close" onclick="this.parentElement.remove()">×</button>
            `;

            container.appendChild(notification);

            // Автоматическое удаление через указанное время
            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.classList.add('hiding');
                        setTimeout(() => {
                            if (notification.parentElement) {
                                notification.remove();
                            }
                        }, 300);
                    }
                }, duration);
            }

            return notification;
        }

        // Функция для переключения страниц
        function showPage(pageId) {
            // Проверяем авторизацию для доступа к профилю и заказу
            if ((pageId === 'profile' || pageId === 'order') && !currentUser) {
                if (pageId === 'order') {
                    showNotification('Для оформления заказа необходимо войти в аккаунт', 'warning');
                    pendingPageAfterLogin = 'order';
                } else {
                    showNotification('Для доступа к профилю необходимо авторизоваться', 'warning');
                    pendingPageAfterLogin = 'profile';
                }
                openLoginModal();
                return;
            }

            // Проверяем доступ к страницам администратора
            if (pageId === 'admin-panel' && (!currentUser || !currentUser.isAdmin)) {
                showNotification('Доступ запрещен. Только для администраторов.', 'error');
                return;
            }

            // Скрыть все страницы
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => {
                page.classList.remove('active');
            });

            // Показать выбранную страницу
            const pageElement = document.getElementById(pageId + '-page');
            if (pageElement) {
                pageElement.classList.add('active');
            }

            // Обновить активную ссылку в навигации
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.textContent === getPageName(pageId)) {
                    link.classList.add('active');
                }
            });

            // Прокрутить вверх
            window.scrollTo(0, 0);

            // Если показываем страницу профиля, показываем соответствующую вкладку
            if (pageId === 'profile') {
                if (currentUser.isAdmin) {
                    showProfileTab('admin-orders');
                } else if (currentUser.isDriver) {
                    showProfileTab('driver-active-orders');
                } else {
                    showProfileTab('data');
                    setTimeout(() => {
                        updateProfileOrderStats();
                    }, 100);
                }
            }

            // Если показываем страницу заказа, заполняем поля данными пользователя
            if (pageId === 'order' && currentUser) {
                fillOrderFormWithUserData();
            }
        }

        // Функция для получения названия страницы по ID
        function getPageName(pageId) {
            const pageNames = {
                'main': 'Главная',
                'about': 'О компании',
                'contacts': 'Контакты',
                'profile': 'Профиль',
                'order': 'Заказать перевозку'
            };

            return pageNames[pageId] || 'Главная';
        }

        // Функция отображения заказов пользователя
        function displayUserOrders(ordersList) {
            const ordersTable = document.getElementById('profile-orders-table');
            
            // Очищаем существующие строки (кроме заголовка)
            const existingRows = ordersTable.querySelectorAll('.order-row');
            existingRows.forEach(row => row.remove());
            
            // Если тело таблицы существует, очищаем его
            let tableBody = ordersTable.querySelector('tbody');
            if (!tableBody) {
                tableBody = document.createElement('tbody');
                ordersTable.appendChild(tableBody);
            }
            tableBody.innerHTML = '';

            ordersList.forEach((order, index) => {
                const row = document.createElement('div');
                row.className = 'order-row';

                // Форматирование даты
                const orderDate = new Date(order.createdAt);
                const formattedDate = orderDate.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });

                // Форматирование даты отправления
                let formattedShippingDate = 'Не указана';
                if (order.shippingDate) {
                    const shippingDate = new Date(order.shippingDate);
                    formattedShippingDate = shippingDate.toLocaleDateString('ru-RU', {
                        day: 'numeric',
                        month: 'short',
                        year: 'numeric'
                    });
                }

                // Получаем статус для клиента
                const clientStatus = order.clientStatus || order.status;
                const statusText = getStatusText(clientStatus, false);
                const statusClass = getStatusClass(clientStatus);

                // Получаем название категории
                const categoryName = getCategoryName(order.productCategory);

                row.innerHTML = `
                    <div class="order-cell order-id" data-label="№ заказа">
                        <span class="order-id-text">#${order.id}</span>
                    </div>
                    <div class="order-cell date-container" data-label="Дата заявки">
                        <span class="date-day">${formattedDate}</span>
                    </div>
                    <div class="order-cell date-container order-shipping-date-cell" data-label="Дата отправки">
                        <span class="date-day">${formattedShippingDate}</span>
                    </div>
                    <div class="order-cell address-container" data-label="Адрес отправления">
                        <span class="address-line">${order.pickupAddress || 'Не указан'}</span>
                    </div>
                    <div class="order-cell address-container" data-label="Адрес доставки">
                        <span class="address-line">${order.deliveryAddress || 'Не указан'}</span>
                    </div>
                    <div class="order-cell" data-label="Груз">
                        <span class="cargo-text">${order.cargoDescription || 'Не указан'}</span>
                    </div>
                    <div class="order-cell order-category-cell" data-label="Категория">
                        <span>${categoryName || 'Не указана'}</span>
                    </div>
                    <div class="order-cell order-status-cell" data-label="Статус">
                        <div class="order-status ${statusClass}">
                            <span class="status-icon">●</span>
                            <span>${statusText}</span>
                        </div>
                    </div>
                    <div class="order-cell" data-label="Расстояние">
                        <span>${order.distance ? order.distance + ' км' : 'Не указано'}</span>
                    </div>
                    <div class="order-cell order-price-cell" data-label="Цена">
                        <span class="order-price">${order.price ? `${order.price} ₽` : 'Рассчитывается'}</span>
                    </div>
                    <div class="order-cell order-actions-cell" data-label="Действия">
                        <div class="actions-container">
                            <div class="order-buttons">
                                <button class="view-btn" onclick="viewOrder(${order.id})">Подробнее</button>
                                ${clientStatus === 'in_transit' || clientStatus === 'in-transit' ? 
                                    `<button class="track-btn" onclick="trackOrder(${order.id})">Отследить</button>` : ''}
                            </div>
                        </div>
                    </div>
                `;

                tableBody.appendChild(row);
            });
        }
        // Обработчик формы профиля
        function handleProfileSubmit(event) {
            event.preventDefault();

            if (!currentUser) {
                showNotification('Для изменения профиля необходимо авторизоваться', 'warning');
                return false;
            }

            const currentPassword = document.getElementById('profile-current-password').value;
            const newPassword = document.getElementById('profile-new-password').value;
            const confirmPassword = document.getElementById('profile-confirm-password').value;

            // Проверка на смену пароля
            if (currentPassword || newPassword || confirmPassword) {
                if (newPassword !== confirmPassword) {
                    showNotification('Новый пароль и подтверждение не совпадают', 'error');
                    return false;
                }
                if (newPassword.length < 6) {
                    showNotification('Новый пароль должен содержать минимум 6 символов', 'error');
                    return false;
                }

                // Проверяем текущий пароль
                if (currentPassword !== currentUser.password) {
                    showNotification('Текущий пароль указан неверно', 'error');
                    return false;
                }

                // Обновляем пароль пользователя
                currentUser.password = newPassword;
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].password = newPassword;
                    localStorage.setItem('transportco_users', JSON.stringify(users));
                    localStorage.setItem('transportco_currentUser', JSON.stringify(currentUser));
                }

                showNotification('Пароль успешно изменен!', 'success');

                // Очищаем поля пароля
                document.getElementById('profile-current-password').value = '';
                document.getElementById('profile-new-password').value = '';
                document.getElementById('profile-confirm-password').value = '';
            }

            showNotification('Изменения сохранены!', 'success');
            return false;
        }

        // Функция для имитации авторизации
        function loginUser() {
            document.getElementById('unauth-buttons').style.display = 'none';
            document.getElementById('auth-user-buttons').style.display = 'flex';

            // Обновляем данные профиля
            if (currentUser) {
                document.getElementById('profile-first-name').value = currentUser.firstName || '';
                document.getElementById('profile-last-name').value = currentUser.lastName || '';
                document.getElementById('profile-email').value = currentUser.email || '';
                document.getElementById('profile-phone').value = currentUser.phone || '';

                // Обновляем навигацию в зависимости от роли
                updateProfileNavigation();
            }
        }

        // Обновление навигации профиля в зависимости от роли
        function updateProfileNavigation() {
            const profileNav = document.querySelector('.profile-nav');
            if (!profileNav) return;

            let navHTML = '';

            if (currentUser.isAdmin) {
                navHTML = `
                    <button class="profile-nav-btn active" onclick="showProfileTab('data')">Данные</button>
                    <button class="profile-nav-btn" onclick="showProfileTab('admin-orders')">Управление заказами</button>
                    <button class="profile-nav-btn" onclick="showProfileTab('driver-applications')">Заявки водителей</button>
                    <button class="profile-nav-btn" onclick="showProfileTab('drivers-list')">Водители</button>
                    <button class="profile-nav-btn" onclick="showProfileTab('resignation-history')">История увольнений</button>
                    <button class="profile-nav-btn" onclick="showProfileTab('admin-stats')">Статистика</button>
                `;

                // Создаем вкладку истории увольнений
                const existingTab = document.getElementById('profile-resignation-history');
                if (!existingTab) {
                    const tabHTML = `
                        <div id="profile-resignation-history" class="profile-tab" style="display: none;">
                            ${showResignationHistory()}
                        </div>
                    `;
                    document.getElementById('profile-tab-content').insertAdjacentHTML('beforeend', tabHTML);
                }
            } else if (currentUser.isDriver) {
                // Навигация для водителя
                navHTML = `
                    <button class="profile-nav-btn active" onclick="showProfileTab('data')">Данные</button>
                    <button class="profile-nav-btn" onclick="showProfileTab('driver-active-orders')">Мои заказы</button>
                    <button class="profile-nav-btn" onclick="showProfileTab('driver-history')">История доставок</button>
                    <button class="profile-nav-btn" onclick="showProfileTab('driver-stats')">Статистика</button>
                `;
            } else {
                // Навигация для обычного пользователя
                navHTML = `
                    <button class="profile-nav-btn active" onclick="showProfileTab('data')">Данные</button>
                    <button class="profile-nav-btn" onclick="showProfileTab('orders')">Мои заказы</button>
                    <button class="profile-nav-btn" onclick="showProfileTab('become-driver')">Стать водителем</button>
                `;
            }

            profileNav.innerHTML = navHTML;
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('transportco_currentUser');
            document.getElementById('unauth-buttons').style.display = 'flex';
            document.getElementById('auth-user-buttons').style.display = 'none';
            showPage('main');
            showNotification('Вы успешно вышли из системы', 'info');
        }

        // Функции для работы с модальными окнами авторизации и регистрации
        function openLoginModal() {
            document.getElementById('loginModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function openRegisterModal() {
            document.getElementById('registerModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeRegisterModal() {
            document.getElementById('registerModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function switchToRegister() {
            closeLoginModal();
            openRegisterModal();
        }

        function switchToLogin() {
            closeRegisterModal();
            openLoginModal();
        }

        // Функции для модальных окон регистрации с SMS
        function openConfirmRegisterCodeModal() {
            document.getElementById('confirmRegisterCodeModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            startRegisterTimer();
        }

        function closeConfirmRegisterCodeModal() {
            document.getElementById('confirmRegisterCodeModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            resetRegisterTimer();
        }

        function backToRegister() {
            closeConfirmRegisterCodeModal();
            openRegisterModal();
        }

        // Функция для перемещения между полями ввода кода при регистрации
        function moveToNextRegister(currentIndex, event) {
            const input = event.target;
            const value = input.value;

            if (value.length === 1 && currentIndex < 4) {
                document.getElementById(`reg-sms-code-${currentIndex + 1}`).focus();
            }

            if (event.inputType === 'deleteContentBackward' && currentIndex > 1 && value.length === 0) {
                document.getElementById(`reg-sms-code-${currentIndex - 1}`).focus();
            }
        }

        // Таймер для повторной отправки кода при регистрации
        let registerTimerInterval;
        let registerTimerSeconds = 59;

        function startRegisterTimer() {
            clearInterval(registerTimerInterval);
            registerTimerSeconds = 59;

            const resendCodeElement = document.getElementById('reg-resend-code');
            resendCodeElement.classList.add('disabled');

            registerTimerInterval = setInterval(() => {
                const timerElement = document.getElementById('reg-sms-timer');
                timerElement.textContent = `Пожалуйста подождите... ${registerTimerSeconds} сек`;

                if (registerTimerSeconds <= 0) {
                    clearInterval(registerTimerInterval);
                    timerElement.textContent = 'Код не пришел?';
                    resendCodeElement.classList.remove('disabled');
                }

                registerTimerSeconds--;
            }, 1000);
        }

        function resetRegisterTimer() {
            clearInterval(registerTimerInterval);
            document.getElementById('reg-sms-timer').textContent = 'Пожалуйста подождите... 59 сек';
            document.getElementById('reg-resend-code').classList.add('disabled');
        }

        // Функция для повторной отправки кода при регистрации
        function resendRegisterCode() {
            const resendCodeElement = document.getElementById('reg-resend-code');

            if (resendCodeElement.classList.contains('disabled')) {
                return;
            }

            showNotification('Код отправлен повторно!', 'success');
            startRegisterTimer();
        }

        // Функция для проверки введенного кода при регистрации
        function verifyRegisterCode() {
            const code1 = document.getElementById('reg-sms-code-1').value;
            const code2 = document.getElementById('reg-sms-code-2').value;
            const code3 = document.getElementById('reg-sms-code-3').value;
            const code4 = document.getElementById('reg-sms-code-4').value;

            const fullCode = code1 + code2 + code3 + code4;

            if (fullCode.length !== 4) {
                showNotification('Пожалуйста, введите полный код из 4 цифр', 'warning');
                return;
            }

            // Проверяем код (для демо используем "1234")
            if (fullCode === "1234") {
                // Регистрируем пользователя
                if (tempRegistrationData) {
                    const newUser = {
                        id: users.length + 1,
                        email: tempRegistrationData.email,
                        phone: tempRegistrationData.phone,
                        password: tempRegistrationData.password,
                        firstName: tempRegistrationData.firstName,
                        lastName: tempRegistrationData.lastName,
                        verified: true
                    };

                    users.push(newUser);
                    localStorage.setItem('transportco_users', JSON.stringify(users));

                    // Авторизуем пользователя
                    currentUser = newUser;
                    localStorage.setItem('transportco_currentUser', JSON.stringify(currentUser));

                    showNotification('Регистрация подтверждена! Вы успешно зарегистрировались.', 'success');
                    closeConfirmRegisterCodeModal();
                    loginUser();

                    // Переход на запомненную страницу или профиль
                    if (pendingPageAfterLogin) {
                        showPage(pendingPageAfterLogin);
                        pendingPageAfterLogin = null;
                    } else {
                        showPage('profile');
                    }
                } else {
                    showNotification('Ошибка регистрации: данные не найдены', 'error');
                }
            } else {
                showNotification('Неверный код подтверждения. Попробуйте еще раз.', 'error');
            }
        }

        // Функции для работы с модальными окнами восстановления пароля
        function openForgotPasswordModal() {
            closeLoginModal();
            document.getElementById('forgotPasswordModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeForgotPasswordModal() {
            document.getElementById('forgotPasswordModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            openLoginModal();
        }

        function openConfirmCodeModal() {
            document.getElementById('confirmCodeModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            startTimer();
        }

        function closeConfirmCodeModal() {
            document.getElementById('confirmCodeModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            resetTimer();
        }

        function backToForgotPassword() {
            closeConfirmCodeModal();
            openForgotPasswordModal();
        }

        // Функция для отправки кода восстановления
        function sendRecoveryCode() {
            const contact = document.getElementById('recovery-contact').value;

            if (!contact) {
                showNotification('Заполните поле с телефоном или email', 'warning');
                return;
            }

            // Проверяем, существует ли пользователь
            const user = users.find(u => u.email === contact || u.phone === contact);
            if (!user) {
                showNotification('Пользователь с указанными данными не найден', 'error');
                return;
            }

            showNotification('Код восстановления отправлен!', 'success');
            closeForgotPasswordModal();
            openConfirmCodeModal();
        }

        // Функция для перемещения между полями ввода кода
        function moveToNext(currentIndex, event) {
            const input = event.target;
            const value = input.value;

            if (value.length === 1 && currentIndex < 4) {
                document.getElementById(`sms-code-${currentIndex + 1}`).focus();
            }

            if (event.inputType === 'deleteContentBackward' && currentIndex > 1 && value.length === 0) {
                document.getElementById(`sms-code-${currentIndex - 1}`).focus();
            }
        }

        // Таймер для повторной отправки кода
        let timerInterval;
        let timerSeconds = 59;

        function startTimer() {
            clearInterval(timerInterval);
            timerSeconds = 59;

            const resendCodeElement = document.getElementById('resend-code');
            resendCodeElement.classList.add('disabled');

            timerInterval = setInterval(() => {
                const timerElement = document.getElementById('sms-timer');
                timerElement.textContent = `Пожалуйста подождите... ${timerSeconds} сек`;

                if (timerSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerElement.textContent = 'Код не пришел?';
                    resendCodeElement.classList.remove('disabled');
                }

                timerSeconds--;
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            document.getElementById('sms-timer').textContent = 'Пожалуйста подождите... 59 сек';
            document.getElementById('resend-code').classList.add('disabled');
        }

        // Функция для повторной отправки кода
        function resendCode() {
            const resendCodeElement = document.getElementById('resend-code');

            if (resendCodeElement.classList.contains('disabled')) {
                return;
            }

            showNotification('Код отправлен повторно!', 'success');
            startTimer();
        }

        // Функция для проверки введенного кода
        function verifyCode() {
            const code1 = document.getElementById('sms-code-1').value;
            const code2 = document.getElementById('sms-code-2').value;
            const code3 = document.getElementById('sms-code-3').value;
            const code4 = document.getElementById('sms-code-4').value;

            const fullCode = code1 + code2 + code3 + code4;

            if (fullCode.length !== 4) {
                showNotification('Пожалуйста, введите полный код из 4 цифр', 'warning');
                return;
            }

            const contact = document.getElementById('recovery-contact').value;

            // Для демо используем "1234" как правильный код
            if (fullCode === "1234") {
                // Запрашиваем новый пароль
                const newPassword = prompt('Введите новый пароль:');

                if (!newPassword || newPassword.length < 6) {
                    showNotification('Пароль должен содержать не менее 6 символов', 'error');
                    return;
                }

                // Находим пользователя и обновляем пароль
                const userIndex = users.findIndex(u => u.email === contact || u.phone === contact);
                if (userIndex !== -1) {
                    users[userIndex].password = newPassword;
                    localStorage.setItem('transportco_users', JSON.stringify(users));

                    // Если текущий пользователь - обновляем его данные
                    if (currentUser && (currentUser.email === contact || currentUser.phone === contact)) {
                        currentUser.password = newPassword;
                        localStorage.setItem('transportco_currentUser', JSON.stringify(currentUser));
                    }

                    showNotification('Пароль успешно изменен! Теперь вы можете войти с новым паролем.', 'success');
                    closeConfirmCodeModal();
                    openLoginModal();
                } else {
                    showNotification('Пользователь не найден', 'error');
                }
            } else {
                showNotification('Неверный код подтверждения', 'error');
            }
        }

        // Функции для отображения ошибок в формах авторизации/регистрации
        function showError(inputId, message) {
            const input = document.getElementById(inputId);
            const errorElement = document.getElementById(inputId + '-error');

            if (input && errorElement) {
                input.classList.add('error');
                errorElement.textContent = message;
                errorElement.classList.add('show');
                errorElement.style.display = 'block';
            }
        }

        function clearError(inputId) {
            const input = document.getElementById(inputId);
            const errorElement = document.getElementById(inputId + '-error');

            if (input && errorElement) {
                input.classList.remove('error');
                errorElement.textContent = '';
                errorElement.classList.remove('show');
                errorElement.style.display = 'none';
            }
        }

        function clearAllErrors() {
            const errorMessages = document.querySelectorAll('.error-message');
            const inputs = document.querySelectorAll('.auth-input');

            errorMessages.forEach(error => {
                error.textContent = '';
                error.classList.remove('show');
                error.style.display = 'none';
            });

            inputs.forEach(input => {
                input.classList.remove('error');
            });
        }

        // Функции для отображения ошибок в форме заказа
        function showOrderError(inputId, message) {
            const input = document.getElementById(inputId);
            const errorElement = document.getElementById(inputId + '-error');

            if (input && errorElement) {
                input.classList.add('error');
                errorElement.textContent = message;
                errorElement.classList.add('show');
                errorElement.style.display = 'block';
            }
        }

        function clearOrderError(inputId) {
            const input = document.getElementById(inputId);
            const errorElement = document.getElementById(inputId + '-error');

            if (input && errorElement) {
                input.classList.remove('error');
                errorElement.textContent = '';
                errorElement.classList.remove('show');
                errorElement.style.display = 'none';
            }
        }

        function clearAllOrderErrors() {
            const errorMessages = document.querySelectorAll('.order-error-message');
            const inputs = document.querySelectorAll('#orderForm input, #orderForm textarea, #orderForm select');

            errorMessages.forEach(error => {
                error.textContent = '';
                error.classList.remove('show');
                error.style.display = 'none';
            });

            inputs.forEach(input => {
                input.classList.remove('error');
            });
        }

        // Обработчики форм
        function handleLogin() {
            const login = document.getElementById('auth-login').value;
            const password = document.getElementById('auth-password').value;

            clearAllErrors();

            let hasError = false;

            if (!login) {
                showError('auth-login', 'Заполните это поле');
                hasError = true;
            }

            if (!password) {
                showError('auth-password', 'Заполните это поле');
                hasError = true;
            }

            if (hasError) {
                return;
            }

            // Поиск пользователя
            const user = users.find(u =>
                (u.email === login || u.phone === login) && u.password === password
            );

            if (user) {
                if (!user.verified) {
                    showError('auth-login', 'Аккаунт не подтвержден. Проверьте вашу почту или телефон.');
                    showNotification('Аккаунт не подтвержден. Проверьте вашу почту или телефон.', 'warning');
                    return;
                }

                currentUser = user;
                localStorage.setItem('transportco_currentUser', JSON.stringify(currentUser));
                showNotification('Вход выполнен успешно!', 'success');
                closeLoginModal();
                loginUser();

                // Переход на запомненную страницу или профиль
                if (pendingPageAfterLogin) {
                    showPage(pendingPageAfterLogin);
                    pendingPageAfterLogin = null;
                } else {
                    showPage('profile');
                }
            } else {
                // Проверяем, что именно неверно
                const userExists = users.some(u => u.email === login || u.phone === login);
                if (!userExists) {
                    showError('auth-login', 'Неверный телефон или email'); // ИЗМЕНЕНО: было "Неверный логин"
                    showNotification('Неверный телефон или email', 'error'); // ИЗМЕНЕНО: было "Пользователь с таким логином не найден"
                } else {
                    showError('auth-password', 'Неверный пароль');
                    showNotification('Неверный пароль', 'error');
                }
            }
        }

        function handleRegister() {
            const firstName = document.getElementById('reg-firstName').value;
            const lastName = document.getElementById('reg-lastName').value;
            const email = document.getElementById('reg-email').value;
            const phone = document.getElementById('reg-phone').value;
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirmPassword').value;
            const agreeTerms = document.getElementById('reg-agreeTerms').checked;

            clearAllErrors();

            let hasError = false;

            if (!firstName) {
                showError('reg-firstName', 'Заполните это поле');
                hasError = true;
            }

            if (!lastName) {
                showError('reg-lastName', 'Заполните это поле');
                hasError = true;
            }

            if (!email) {
                showError('reg-email', 'Заполните это поле');
                hasError = true;
            } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showError('reg-email', 'Введите корректный email');
                hasError = true;
            } else if (users.some(u => u.email === email)) {
                showError('reg-email', 'Пользователь с таким email уже существует');
                hasError = true;
            }

            if (!phone) {
                showError('reg-phone', 'Заполните это поле');
                hasError = true;
            } else if (users.some(u => u.phone === phone)) {
                showError('reg-phone', 'Пользователь с таким телефоном уже существует');
                hasError = true;
            }

            if (!password) {
                showError('reg-password', 'Заполните это поле');
                hasError = true;
            } else if (password.length < 6) {
                showError('reg-password', 'Пароль должен содержать не менее 6 символов');
                hasError = true;
            }

            if (!confirmPassword) {
                showError('reg-confirmPassword', 'Заполните это поле');
                hasError = true;
            } else if (password !== confirmPassword) {
                showError('reg-confirmPassword', 'Пароли не совпадают');
                hasError = true;
            }

            if (!agreeTerms) {
                showNotification('Необходимо согласиться с условиями использования', 'warning');
                return;
            }

            if (hasError) {
                return;
            }

            // Сохраняем данные регистрации
            tempRegistrationData = {
                firstName,
                lastName,
                email,
                phone,
                password
            };

            showNotification('Регистрация начата! Проверьте SMS для подтверждения.', 'info');

            // Закрываем окно регистрации и открываем окно подтверждения SMS
            closeRegisterModal();
            openConfirmRegisterCodeModal();
        }

        // Функция для извлечения города из адреса
        function extractCityFromAddress(address) {
            if (!address) return '';

            // Простой способ извлечь город (первое слово до запятой)
            const parts = address.split(',');
            if (parts.length > 0) {
                return parts[0].trim();
            }

            // Если нет запятых, берем первое слово
            const words = address.trim().split(' ');
            return words[0] || '';
        }

        // Функция расчета расстояния между адресами
        function calculateDistanceBetweenAddresses(address1, address2) {
            const city1 = extractCityFromAddress(address1);
            const city2 = extractCityFromAddress(address2);

            return calculateDistance(city1, city2);
        }

        // Функция расчета цены с учетом расстояния и страховки 1%
        function calculateOrderPrice(orderData, distance) {
            // Базовые тарифы
            const BASE_PRICE = 1000; // Базовая стоимость заказа
            const PRICE_PER_KM = 20; // Стоимость за километр
            const PRICE_PER_KG = 80; // Стоимость за килограмм
            const PRICE_PER_M3 = 400; // Стоимость за кубический метр

            // Коэффициенты для типов груза
            const cargoTypeMultiplier = {
                'general': 1.0,
                'fragile': 1.3,
                'dangerous': 1.5,
                'perishable': 1.4
            };

            // Рассчитываем компоненты стоимости
            const distanceCost = distance * PRICE_PER_KM;
            const weightCost = orderData.cargoWeight * PRICE_PER_KG;
            const volumeCost = orderData.cargoVolume * PRICE_PER_M3;

            // Рассчитываем стоимость доставки
            let deliveryCost = BASE_PRICE + distanceCost + weightCost + volumeCost;

            // Применяем коэффициент типа груза
            const multiplier = cargoTypeMultiplier[orderData.cargoType] || 1.0;
            deliveryCost *= multiplier;

            // Дополнительные услуги
            let additionalCost = 0;
            if (orderData.packaging) {
                additionalCost += 2000; // Упаковка
            }

            // Страховка - 1% от стоимости доставки
            if (orderData.insurance) {
                const insuranceCost = deliveryCost * 0.01;
                additionalCost += insuranceCost;
            }

            // Итоговая стоимость
            const totalPrice = Math.round(deliveryCost + additionalCost);

            return totalPrice;
        }

        // функция handleOrderSubmit
        function handleOrderSubmit(event) {
            event.preventDefault();

            clearAllOrderErrors();

            const senderName = document.getElementById('sender-name').value;
            const senderPhone = document.getElementById('sender-phone').value;
            const senderEmail = document.getElementById('sender-email').value;
            const cargoDescription = document.getElementById('cargo-description').value;
            const productCategory = document.getElementById('product-category').value;
            const cargoWeight = document.getElementById('cargo-weight').value;
            const cargoVolume = document.getElementById('cargo-volume').value;
            const cargoType = document.getElementById('cargo-type').value;
            const shippingDate = document.getElementById('shipping-date').value;
            const pickupAddress = document.getElementById('pickup-address').value;
            const deliveryAddress = document.getElementById('delivery-address').value;
            const insurance = document.getElementById('insurance').checked;
            const packaging = document.getElementById('packaging').checked;
            const tracking = document.getElementById('tracking').checked;
            const comments = document.getElementById('comments').value;

            let hasError = false;

            if (!senderName) {
                showOrderError('sender-name', 'Заполните это поле');
                hasError = true;
            }

            if (!senderPhone) {
                showOrderError('sender-phone', 'Заполните это поле');
                hasError = true;
            }

            if (!cargoDescription) {
                showOrderError('cargo-description', 'Заполните это поле');
                hasError = true;
            }

            if (!productCategory) {
                showOrderError('product-category', 'Выберите категорию товара');
                hasError = true;
            }

            if (!cargoWeight || parseFloat(cargoWeight) <= 0) {
                showOrderError('cargo-weight', 'Введите корректный вес');
                hasError = true;
            }

            if (!cargoVolume || parseFloat(cargoVolume) <= 0) {
                showOrderError('cargo-volume', 'Введите корректный объем');
                hasError = true;
            }

            if (!cargoType) {
                showOrderError('cargo-type', 'Выберите тип груза');
                hasError = true;
            }

            if (!shippingDate) {
                showOrderError('shipping-date', 'Выберите дату отправки');
                hasError = true;
            }

            if (!pickupAddress) {
                showOrderError('pickup-address', 'Заполните это поле');
                hasError = true;
            }

            if (!deliveryAddress) {
                showOrderError('delivery-address', 'Заполните это поле');
                hasError = true;
            }

            if (hasError) {
                showNotification('Пожалуйста, заполните все обязательные поля корректно', 'warning');
                return false;
            }

            // РАСЧЕТ РАССТОЯНИЯ
            const distance = calculateDistanceBetweenAddresses(pickupAddress, deliveryAddress);

            // Создаем объект с данными заказа для расчета цены
            const orderDataForPrice = {
                cargoWeight: parseFloat(cargoWeight),
                cargoVolume: parseFloat(cargoVolume),
                cargoType: cargoType,
                insurance: insurance,
                packaging: packaging
            };

            // Рассчитываем цену с учетом расстояния
            const calculatedPrice = calculateOrderPrice(orderDataForPrice, distance);

            const maxId = orders.length > 0 ? Math.max(...orders.map(order => order.id)) : 0;
            const orderRecord = {
                id: maxId + 1,
                userId: currentUser ? currentUser.id : null,
                senderName,
                senderPhone,
                senderEmail,
                cargoDescription,
                productCategory,
                cargoWeight: parseFloat(cargoWeight),
                cargoVolume: parseFloat(cargoVolume),
                cargoType,
                shippingDate,
                pickupAddress,
                deliveryAddress,
                distance: distance, // Сохраняем расстояние
                insurance,
                packaging,
                tracking,
                comments,
                status: ORDER_STATUSES.ADMIN.NEW,
                clientstatus: ORDER_STATUSES.CLIENT.PROCESSING,
                price: calculatedPrice, // Используем новую рассчитанную цену
                createdAt: new Date().toISOString()
            };

            orders.push(orderRecord);
            localStorage.setItem('transportco_orders', JSON.stringify(orders));

            // Показываем уведомление с информацией о цене и расстоянии
            let notificationMessage = `Заказ успешно оформлен!`;
            notificationMessage += `<br>Расстояние: ${distance} км`;
            notificationMessage += `<br>Стоимость доставки: ${calculatedPrice} ₽`;

            if (insurance) {
                notificationMessage += '<br>Включена страховка: 1% от стоимости доставки';
            }

            notificationMessage += '<br>Наш менеджер свяжется с вами в течение 30 минут.';

            // Показываем расширенное уведомление
            const notification = showNotification(notificationMessage, 'success', 8000);

            // Добавляем HTML форматирование в уведомление
            const contentDiv = notification.querySelector('.notification-content');
            contentDiv.innerHTML = notificationMessage;

            // Сбрасываем форму
            document.getElementById('orderForm').reset();

            // Если пользователь авторизован, показываем профиль
            if (currentUser) {
                showPage('profile');
                showProfileTab('orders');
                updateProfileOrderStats();
            } else {
                showPage('main');
            }

            return false;
        }

        function handleContactSubmit(event) {
            event.preventDefault();

            const contactData = {
                name: document.getElementById('contact-name').value,
                email: document.getElementById('contact-email').value,
                phone: document.getElementById('contact-phone').value,
                message: document.getElementById('contact-message').value
            };

            showNotification('Сообщение успешно отправлено! Мы ответим вам в ближайшее время.', 'success');
            document.getElementById('contactForm').reset();

            return false;
        }

        // Функции для страницы "Мои заказы" в профиле
        function toggleOrdersVisibility(hasOrders) {
            const ordersTable = document.getElementById('profile-orders-table');
            const noOrdersMessage = document.getElementById('profile-no-orders-message');

            if (hasOrders) {
                if (ordersTable) ordersTable.style.display = 'block';
                if (noOrdersMessage) noOrdersMessage.style.display = 'none';
            } else {
                if (ordersTable) ordersTable.style.display = 'none';
                if (noOrdersMessage) noOrdersMessage.style.display = 'block';
            }
}

        function viewOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const user = users.find(u => u.id === order.userId);
            const driver = order.driverId ? drivers.find(d => d.userId === order.driverId) : null;
            const driverUser = driver ? users.find(u => u.id === driver.userId) : null;

            let modalHTML = `
                <div class="modal active" id="orderDetailsModal">
                    <div class="auth-container order-details-modal">
                        <div class="auth-header">
                            <button class="close-auth-btn" onclick="closeModal('orderDetailsModal')">×</button>
                            <div class="auth-logo">Заказ #${orderId}</div>
                        </div>

                        <div class="auth-form-container">
                            <div class="order-detail-item">
                                <div class="order-detail-label">Статус</div>
                                <div class="order-detail-value">
                                    <span class="status-badge status-${order.status}">${getStatusText(order.status)}</span>
                                </div>
                            </div>

                            <div class="order-form-row">
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Клиент</div>
                                    <div class="order-detail-value">${user ? `${user.firstName} ${user.lastName}` : 'Неизвестно'}</div>
                                </div>
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Телефон</div>
                                    <div class="order-detail-value">${order.senderPhone}</div>
                                </div>
                            </div>

                            <div class="order-detail-item">
                                <div class="order-detail-label">Маршрут</div>
                                <div class="order-detail-value">
                                    <div><strong>Откуда:</strong> ${order.pickupAddress}</div>
                                    <div><strong>Куда:</strong> ${order.deliveryAddress}</div>
                                    <div><strong>Расстояние:</strong> ${order.distance} км</div>
                                </div>
                            </div>

                            <div class="order-detail-item">
                                <div class="order-detail-label">Груз</div>
                                <div class="order-detail-value">
                                    <div><strong>Описание:</strong> ${order.cargoDescription}</div>
                                    <div><strong>Категория:</strong> ${getCategoryName(order.productCategory)}</div>
                                    <div><strong>Тип:</strong> ${order.cargoType === 'general' ? 'Общий' : order.cargoType === 'fragile' ? 'Хрупкий' : order.cargoType === 'dangerous' ? 'Опасный' : 'Скоропортящийся'}</div>
                                    <div><strong>Вес/Объем:</strong> ${order.cargoWeight} кг / ${order.cargoVolume} м³</div>
                                </div>
                            </div>

                            <div class="order-detail-item">
                                <div class="order-detail-label">Стоимость</div>
                                <div class="order-detail-value">
                                    <div><strong>Общая:</strong> ${order.price} ₽</div>
                                    ${order.cancellationFee ? `<div><strong>Штраф за отмену:</strong> ${order.cancellationFee} ₽</div>` : ''}
                                    ${order.refundAmount ? `<div><strong>К возврату:</strong> ${order.refundAmount} ₽</div>` : ''}
                                </div>
                            </div>

                            ${driver ? `
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Водитель</div>
                                    <div class="order-detail-value">
                                        <div><strong>ФИО:</strong> ${driverUser ? `${driverUser.firstName} ${driverUser.lastName}` : 'Неизвестно'}</div>
                                        <div><strong>Автомобиль:</strong> ${driver.carModel} (${driver.carNumber})</div>
                                        <div><strong>Телефон:</strong> ${driverUser ? driverUser.phone : 'Неизвестно'}</div>
                                    </div>
                                </div>
                            ` : ''}

                            ${order.comments ? `
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Комментарий клиента</div>
                                    <div class="order-detail-value">${order.comments}</div>
                                </div>
                            ` : ''}

                            ${order.adminComment ? `
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Комментарий администратора</div>
                                    <div class="order-detail-value">${order.adminComment}</div>
                                </div>
                            ` : ''}

                            <div class="forgot-password-buttons">
                                ${currentUser.isAdmin && order.status === 'new' ? `
                                    <button class="recovery-btn" onclick="openOrderModal(${orderId}); closeModal('orderDetailsModal')">Обработать заказ</button>
                                ` : ''}

                                ${currentUser.isAdmin && order.status === 'confirmed' && !order.driverId ? `
                                    <button class="recovery-btn" onclick="assignDriverModal(${orderId}); closeModal('orderDetailsModal')">Назначить водителя</button>
                                ` : ''}

                                ${order.userId === currentUser.id && order.status !== 'cancelled' && order.status !== 'delivered' ? `
                                    <button class="back-btn" onclick="openCancelOrderModal(${orderId})">Отменить заказ</button>
                                ` : ''}

                                <button class="back-btn" onclick="closeModal('orderDetailsModal')">Закрыть</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function trackOrder(orderId) {
            showNotification(`Отслеживание заказа ${orderId}`, 'info');
        }

        // Закрытие модальных окон при клике вне их
        document.addEventListener('click', function(event) {
            const modals = ['loginModal', 'registerModal', 'forgotPasswordModal', 'confirmCodeModal', 'confirmRegisterCodeModal'];

            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    if (modalId === 'loginModal') closeLoginModal();
                    if (modalId === 'registerModal') closeRegisterModal();
                    if (modalId === 'forgotPasswordModal') closeForgotPasswordModal();
                    if (modalId === 'confirmCodeModal') closeConfirmCodeModal();
                    if (modalId === 'confirmRegisterCodeModal') closeConfirmRegisterCodeModal();
                }
            });
        });

        // Закрытие модальных окон при нажатии Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeLoginModal();
                closeRegisterModal();
                closeForgotPasswordModal();
                closeConfirmCodeModal();
                closeConfirmRegisterCodeModal();
            }
        });

        //  ФУНКЦИИ ДЛЯ ВОДИТЕЛЕЙ

        // Принять заказ водителем
        function acceptOrder(orderId) {
            if (!currentUser || !currentUser.isDriver) {
                showNotification('Только водители могут принимать заказы', 'error');
                return;
            }

            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) {
                showNotification('Заказ не найден', 'error');
                return;
            }

            const driver = drivers.find(d => d.userId === currentUser.id);
            if (!driver) {
                showNotification('Данные водителя не найдены', 'error');
                return;
            }

            // Обновляем статус заказа и назначаем водителя
            orders[orderIndex].status = ORDER_STATUSES.ADMIN.IN_TRANSIT;
            orders[orderIndex].clientStatus = ORDER_STATUSES.CLIENT.IN_TRANSIT;
            orders[orderIndex].driverId = currentUser.id;
            orders[orderIndex].acceptedAt = new Date().toISOString();

            // Сохраняем изменения
            localStorage.setItem('transportco_orders', JSON.stringify(orders));

            // Создаем уведомление для клиента
            createNotification(
                orders[orderIndex].userId,
                'Водитель назначен',
                `На ваш заказ #${orderId} назначен водитель. Заказ в пути.`,
                'info'
            );

            showNotification('Заказ успешно принят!', 'success');
            loadDriverActiveOrders();

            // Обновляем статистику водителя
            updateDriverStats();
        }

        // Загрузка активных заказов водителя
        function loadDriverActiveOrders() {
            if (!currentUser || !currentUser.isDriver) return;

            const activeOrders = orders.filter(order =>
                order.driverId === currentUser.id &&
                (order.status === 'in_transit' || order.status === 'confirmed')
            );

            const container = document.getElementById('driver-active-orders-list');
            const noOrders = document.getElementById('driver-no-active-orders');

            if (activeOrders.length === 0) {
                if (container) container.style.display = 'none';
                if (noOrders) noOrders.style.display = 'block';
                return;
            }

            if (container) container.style.display = 'block';
            if (noOrders) noOrders.style.display = 'none';

            let html = `
                <div class="table-header">
                    <div class="table-header-item">№</div>
                    <div class="table-header-item">КЛИЕНТ</div>
                    <div class="table-header-item">МАРШРУТ</div>
                    <div class="table-header-item">ГРУЗ</div>
                    <div class="table-header-item">СТАТУС</div>
                    <div class="table-header-item">ДЕЙСТВИЯ</div>
                </div>
            `;

            activeOrders.forEach((order, index) => {
                const user = users.find(u => u.id === order.userId);
                const clientName = user ? `${user.firstName} ${user.lastName}` : 'Неизвестно';

                html += `
                    <div class="order-row">
                        <div class="order-cell" data-label="№">${order.id}</div>
                        <div class="order-cell" data-label="Клиент">${clientName}</div>
                        <div class="order-cell address-container" data-label="Маршрут">
                            <span class="address-line">${order.pickupAddress}</span>
                            <span class="address-line"> → ${order.deliveryAddress}</span>
                        </div>
                        <div class="order-cell" data-label="Груз">${order.cargoDescription}</div>
                        <div class="order-cell" data-label="Статус">
                            <div class="order-status ${getStatusClass(order.status)}">
                                <span class="status-icon">●</span>
                                <span>${getStatusText(order.status)}</span>
                            </div>
                        </div>
                        <div class="order-cell" data-label="Действия">
                            ${order.status === 'confirmed' ?
                                `<button class="track-btn" onclick="markAsInTransit(${order.id})">Груз принят</button>` :
                                `<button class="track-btn" onclick="markAsDelivered(${order.id})">Доставлено</button>`
                            }
                        </div>
                    </div>
                `;
            });

            if (container) container.innerHTML = html;
        }

        // Отметить груз как принятый (статус В пути)
        function markAsInTransit(orderId) {
            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;

            orders[orderIndex].status = ORDER_STATUSES.ADMIN.IN_TRANSIT;
            orders[orderIndex].clientStatus = ORDER_STATUSES.CLIENT.IN_TRANSIT;
            orders[orderIndex].inTransitAt = new Date().toISOString();
            localStorage.setItem('transportco_orders', JSON.stringify(orders));

            createNotification(
                orders[orderIndex].userId,
                'Заказ в пути',
                `Ваш заказ #${orderId} принят водителем и находится в пути.`,
                'info'
            );

            showNotification('Груз отмечен как принятый', 'success');
            loadDriverActiveOrders();
        }

        // Отметить заказ как доставленный
        function markAsDelivered(orderId) {
            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;

            orders[orderIndex].status = ORDER_STATUSES.ADMIN.DELIVERED;
            orders[orderIndex].clientStatus = ORDER_STATUSES.CLIENT.DELIVERED;
            orders[orderIndex].deliveredAt = new Date().toISOString();

            // Обновляем статистику водителя
            const driver = drivers.find(d => d.userId === currentUser.id);
            if (driver) {
                driver.completedDeliveries = (driver.completedDeliveries || 0) + 1;
                localStorage.setItem('transportco_drivers', JSON.stringify(drivers));
            }

            localStorage.setItem('transportco_orders', JSON.stringify(orders));

            createNotification(
                orders[orderIndex].userId,
                'Заказ доставлен',
                `Ваш заказ #${orderId} успешно доставлен. Спасибо, что выбрали нас!`,
                'success'
            );

            showNotification('Заказ отмечен как доставленный', 'success');
            loadDriverActiveOrders();
            loadDriverHistory();
            updateDriverStats();
        }

        // Загрузка истории доставок водителя
        function loadDriverHistory() {
            if (!currentUser || !currentUser.isDriver) return;

            const historyOrders = orders.filter(order =>
                order.driverId === currentUser.id &&
                order.status === 'delivered'
            );

            const container = document.getElementById('driver-history-list');
            const noHistory = document.getElementById('driver-no-history');

            if (historyOrders.length === 0) {
                if (container) container.style.display = 'none';
                if (noHistory) noHistory.style.display = 'block';
                return;
            }

            if (container) container.style.display = 'block';
            if (noHistory) noHistory.style.display = 'none';

            let html = `
                <div class="table-header">
                    <div class="table-header-item">№</div>
                    <div class="table-header-item">КЛИЕНТ</div>
                    <div class="table-header-item">МАРШРУТ</div>
                    <div class="table-header-item">ДАТА ДОСТАВКИ</div>
                    <div class="table-header-item">СТОИМОСТЬ</div>
                </div>
            `;

            historyOrders.forEach((order, index) => {
                const user = users.find(u => u.id === order.userId);
                const clientName = user ? `${user.firstName} ${user.lastName}` : 'Неизвестно';

                html += `
                    <div class="order-row">
                        <div class="order-cell" data-label="№">${order.id}</div>
                        <div class="order-cell" data-label="Клиент">${clientName}</div>
                        <div class="order-cell address-container" data-label="Маршрут">
                            <span class="address-line">${order.pickupAddress}</span>
                            <span class="address-line">→ ${order.deliveryAddress}</span>
                        </div>
                        <div class="order-cell date-container" data-label="Дата доставки">
                            <span class="date-day">${new Date(order.deliveredAt).toLocaleDateString()}</span>
                        </div>
                        <div class="order-cell" data-label="Стоимость">${order.price || 'Не указана'} ₽</div>
                    </div>
                `;
            });

            if (container) container.innerHTML = html;
        }

        // Обновление статистики водителя
        function updateDriverStats() {
            if (!currentUser || !currentUser.isDriver) return;

            const driver = drivers.find(d => d.userId === currentUser.id);
            if (!driver) return;

            // Заполняем данные
            document.getElementById('driver-total-deliveries').textContent = driver.completedDeliveries || 0;
            document.getElementById('driver-earnings').textContent = calculateDriverEarnings();
            document.getElementById('driver-avg-delivery-time').textContent = '24';

            // Данные автомобиля
            document.getElementById('driver-car-model').value = driver.carModel || '';
            document.getElementById('driver-car-number').value = driver.carNumber || '';
            document.getElementById('driver-max-weight').value = `${driver.maxWeight || 0} кг`;
            document.getElementById('driver-status').value = driver.workStatus === 'active' ? 'Активен' : 'Неактивен';

            // Добавляем переключатель статуса работы
            if (currentUser.isDriver) {
                const driver = drivers.find(d => d.userId === currentUser.id);
                if (driver) {
                    const statusSection = document.querySelector('#profile-driver-stats .profile-section:last-child');
                    
                    // Создаем или обновляем переключатель
                    let statusToggle = statusSection.querySelector('#work-status-toggle');
                    if (!statusToggle) {
                        statusToggle = document.createElement('div');
                        statusToggle.id = 'work-status-toggle';
                        statusToggle.style.marginTop = '20px';
                        statusToggle.innerHTML = `
                            <h3>Статус работы</h3>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <button id="toggle-work-status" class="order-submit-btn" 
                                        style="background: ${driver.workStatus === 'active' ? '#28a745' : '#6c757d'};">
                                    ${driver.workStatus === 'active' ? 'Активен' : 'Неактивен'}
                                </button>
                                <span style="color: #666; font-size: 14px;">
                                    ${driver.workStatus === 'active' 
                                        ? 'Вы видите все доступные заказы и можете их принимать' 
                                        : 'Вы не видите новые заказы и не можете их принимать'}
                                </span>
                            </div>
                        `;
                        statusSection.appendChild(statusToggle);
                        
                        // Назначаем обработчик
                        document.getElementById('toggle-work-status').onclick = toggleWorkStatus;
                    } else {
                        const btn = statusToggle.querySelector('#toggle-work-status');
                        btn.style.background = driver.workStatus === 'active' ? '#28a745' : '#6c757d';
                        btn.textContent = driver.workStatus === 'active' ? 'Активен' : 'Неактивен';
                        const span = statusToggle.querySelector('span');
                        span.textContent = driver.workStatus === 'active' 
                            ? 'Вы видите все доступные заказы и можете их принимать' 
                            : 'Вы не видите новые заказы и не можете их принимать';
                    }
                }
            }

            const statsSection = document.querySelector('#profile-driver-stats .profile-section:last-child');
            if (statsSection && driver.status === 'active') {
                let resignButton = statsSection.querySelector('#resign-driver-btn');
                if (!resignButton) {
                    resignButton = document.createElement('button');
                    resignButton.id = 'resign-driver-btn';
                    resignButton.className = 'order-submit-btn';
                    resignButton.style.background = '#dc3545';
                    resignButton.style.marginTop = '20px';
                    resignButton.textContent = 'Уволиться';
                    resignButton.onclick = resignDriver;
                    statsSection.appendChild(resignButton);
                }
            }
        }

        // Функция переключения статуса работы водителя
        function toggleWorkStatus() {
            if (!currentUser || !currentUser.isDriver) {
                showNotification('Эта функция доступна только водителям', 'warning');
                return;
            }
            
            const driverIndex = drivers.findIndex(d => d.userId === currentUser.id);
            if (driverIndex === -1) return;
            
            // Переключаем статус
            const newStatus = drivers[driverIndex].workStatus === 'active' ? 'inactive' : 'active';
            drivers[driverIndex].workStatus = newStatus;
            
            // Сохраняем изменения
            localStorage.setItem('transportco_drivers', JSON.stringify(drivers));
            
            // Обновляем отображение
            updateDriverStats();
            
            // Показываем уведомление
            showNotification(`Статус работы изменен на "${newStatus === 'active' ? 'Активен' : 'Неактивен'}"`, 'success');

            if (currentUser.isAdmin) {
                loadDriversList();
            }
        }

        // Расчет заработка водителя
        function calculateDriverEarnings() {
            if (!currentUser || !currentUser.isDriver) return 0;

            const driverOrders = orders.filter(order =>
                order.driverId === currentUser.id &&
                order.status === 'delivered'
            );

            // Предположим, что водитель получает 70% от стоимости заказа
            return driverOrders.reduce((sum, order) => sum + (order.price * 0.7), 0).toFixed(0);
        }

        // Функция для увольнения/деактивации водителя (самостоятельно)
        function resignDriver() {
            if (!currentUser || !currentUser.isDriver) {
                showNotification('Эта функция доступна только водителям', 'warning');
                return;
            }

            // Проверяем, есть ли активные заказы
            const activeOrders = orders.filter(order =>
                order.driverId === currentUser.id &&
                (order.status === 'confirmed' || order.status === 'in_transit')
            );

            if (activeOrders.length > 0) {
                showNotification(`У вас есть ${activeOrders.length} активных заказа(ов). Завершите их или передайте другому водителю перед увольнением.`, 'error');
                return;
            }

            // Показываем модальное окно подтверждения
            const modalHTML = `
                <div class="modal active" id="resignModal">
                    <div class="auth-container" style="max-width: 500px;">
                        <div class="auth-header">
                            <button class="close-auth-btn" onclick="closeModal('resignModal')">×</button>
                            <div class="auth-logo">Увольнение</div>
                        </div>

                        <div class="auth-form-container">
                            <h3 style="margin-bottom: 15px; color: #333;">Вы уверены, что хотите уволиться?</h3>
                            <p style="margin-bottom: 20px; color: #666;">Это действие:</p>
                            <ul style="margin-bottom: 20px; padding-left: 20px; color: #666;">
                                <li>Сделает ваш профиль водителя неактивным</li>
                                <li>Вы больше не сможете принимать новые заказы</li>
                                <li>Ваша статистика будет сохранена</li>
                                <li>Вы сможете восстановить статус через администратора</li>
                            </ul>

                            <div class="order-form-group">
                                <label for="resign-reason">Причина ухода (необязательно)</label>
                                <textarea id="resign-reason" rows="3" placeholder="Укажите причину ухода..."></textarea>
                            </div>

                            <div class="forgot-password-buttons">
                                <button class="back-btn" onclick="closeModal('resignModal')">Отмена</button>
                                <button class="recovery-btn" style="background: #dc3545;" onclick="confirmResignation()">Подтвердить увольнение</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Подтверждение увольнения
        function confirmResignation() {
            const reason = document.getElementById('resign-reason').value;

            const driverIndex = drivers.findIndex(d => d.userId === currentUser.id);
            if (driverIndex === -1) {
                showNotification('Ошибка: данные водителя не найдены', 'error');
                return;
            }

            // Сохраняем запись об увольнении
            const resignationRecord = {
                id: Date.now(),
                userId: currentUser.id,
                driverId: drivers[driverIndex].id,
                reason: reason,
                resignedAt: new Date().toISOString(),
                previousStatus: drivers[driverIndex].status,
                rating: drivers[driverIndex].rating,
                completedDeliveries: drivers[driverIndex].completedDeliveries
            };

            // Сохраняем в localStorage
            let resignations = JSON.parse(localStorage.getItem('transportco_driver_resignations')) || [];
            resignations.push(resignationRecord);
            localStorage.setItem('transportco_driver_resignations', JSON.stringify(resignations));

            // Деактивируем водителя
            drivers[driverIndex].status = 'inactive';
            drivers[driverIndex].inactiveSince = new Date().toISOString();
            drivers[driverIndex].inactiveReason = 'resignation';
            drivers[driverIndex].resignationReason = reason;

            // Обновляем пользователя
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].isDriver = false; // Снимаем флаг водителя
            }

            // Обновляем текущего пользователя
            currentUser.isDriver = false;

            // Сохраняем изменения
            localStorage.setItem('transportco_drivers', JSON.stringify(drivers));
            localStorage.setItem('transportco_users', JSON.stringify(users));
            localStorage.setItem('transportco_currentUser', JSON.stringify(currentUser));

            // Уведомляем администраторов
            const admins = users.filter(u => u.isAdmin);
            admins.forEach(admin => {
                createNotification(
                    admin.id,
                    'Водитель уволился',
                    `Водитель ${currentUser.firstName} ${currentUser.lastName} уволился.${reason ? ` Причина: ${reason}` : ''}`,
                    'warning'
                );
            });

            showNotification('Вы успешно уволились. Ваш профиль водителя деактивирован.', 'info');
            closeModal('resignModal');

            // Обновляем интерфейс
            updateProfileNavigation();
            showProfileTab('data');
            updateDriverStats();

            // Скрываем блок "Статус заявки" после увольнения
            const applicationStatus = document.getElementById('driver-application-status');
            if (applicationStatus) {
                applicationStatus.style.display = 'none';
            }
        }

        // Функция для увольнения водителя администратором
        function dismissDriver(driverUserId, reason = '') {
            if (!currentUser || !currentUser.isAdmin) {
                showNotification('Только администратор может уволить водителя', 'error');
                return;
            }

            const driver = drivers.find(d => d.userId === driverUserId);
            const driverUser = users.find(u => u.id === driverUserId);

            if (!driver || !driverUser) {
                showNotification('Водитель не найден', 'error');
                return;
            }

            if (driver.status === 'inactive') {
                showNotification('Этот водитель уже уволен', 'warning');
                return;
            }

            // Проверяем активные заказы
            const activeOrders = orders.filter(order =>
                order.driverId === driverUserId &&
                (order.status === 'confirmed' || order.status === 'in_transit')
            );

            if (activeOrders.length > 0) {
                // Создаем модальное окно для обработки активных заказов
                const modalHTML = `
                    <div class="modal active" id="dismissDriverModal">
                        <div class="auth-container" style="max-width: 600px;">
                            <div class="auth-header">
                                <button class="close-auth-btn" onclick="closeModal('dismissDriverModal')">×</button>
                                <div class="auth-logo">Увольнение водителя</div>
                            </div>

                            <div class="auth-form-container">
                                <h3 style="margin-bottom: 15px; color: #333;">У водителя ${driverUser.firstName} ${driverUser.lastName} есть активные заказы:</h3>

                                <div style="max-height: 200px; overflow-y: auto; margin-bottom: 20px;">
                                    ${activeOrders.map(order => `
                                        <div class="driver-card" style="margin-bottom: 10px;">
                                            <div><strong>Заказ #${order.id}</strong></div>
                                            <div>${order.pickupAddress} → ${order.deliveryAddress}</div>
                                            <div>Статус: ${getStatusText(order.status)}</div>
                                        </div>
                                    `).join('')}
                                </div>

                                <div class="order-form-group">
                                    <label for="dismiss-action">Действие с заказами:</label>
                                    <select id="dismiss-action">
                                        <option value="reassign">Переназначить другому водителю</option>
                                        <option value="cancel">Отменить заказы (с возвратом средств)</option>
                                        <option value="keep">Оставить текущему водителю (он завершит их)</option>
                                    </select>
                                </div>

                                <div class="order-form-group">
                                    <label for="dismiss-reason">Причина увольнения</label>
                                    <textarea id="dismiss-reason" rows="3" placeholder="Укажите причину увольнения..." required>${reason}</textarea>
                                </div>

                                <div class="forgot-password-buttons">
                                    <button class="back-btn" onclick="closeModal('dismissDriverModal')">Отмена</button>
                                    <button class="recovery-btn" style="background: #dc3545;" onclick="processDismissal(${driverUserId})">Уволить водителя</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                document.body.insertAdjacentHTML('beforeend', modalHTML);
                return;
            }

            // Если активных заказов нет, сразу увольняем
            processDismissal(driverUserId, reason);
        }

        // Обработка увольнения администратором
        function processDismissal(driverUserId, reason = null) {
            if (!reason) {
                reason = document.getElementById('dismiss-reason')?.value || '';
            }

            const driverIndex = drivers.findIndex(d => d.userId === driverUserId);
            const driver = drivers[driverIndex];
            const driverUser = users.find(u => u.id === driverUserId);

            if (!driver || !driverUser) return;

            const action = document.getElementById('dismiss-action')?.value || 'reassign';
            const activeOrders = orders.filter(order =>
                order.driverId === driverUserId &&
                (order.status === 'confirmed' || order.status === 'in_transit')
            );

            // Обрабатываем активные заказы
            if (action === 'reassign' && activeOrders.length > 0) {
                // Находим свободных водителей
                const availableDrivers = drivers.filter(d =>
                    d.userId !== driverUserId &&
                    d.status === 'active' &&
                    d.maxWeight >= Math.max(...activeOrders.map(o => o.cargoWeight || 0))
                );

                if (availableDrivers.length === 0) {
                    showNotification('Нет доступных водителей для переназначения заказов', 'warning');
                    return;
                }

                // Переназначаем заказы
                activeOrders.forEach(order => {
                    const orderIndex = orders.findIndex(o => o.id === order.id);
                    // Выбираем случайного водителя
                    const newDriver = availableDrivers[Math.floor(Math.random() * availableDrivers.length)];
                    orders[orderIndex].driverId = newDriver.userId;
                    orders[orderIndex].previousDriverId = driverUserId;
                    orders[orderIndex].reassignedAt = new Date().toISOString();

                    // Уведомляем нового водителя
                    createNotification(
                        newDriver.userId,
                        'Новый заказ назначен',
                        `Вам назначен заказ #${order.id} (переназначен с другого водителя)`,
                        'info'
                    );

                    // Уведомляем клиента
                    createNotification(
                        order.userId,
                        'Смена водителя',
                        `Водитель по вашему заказу #${order.id} изменен.`,
                        'info'
                    );
                });
            } else if (action === 'cancel' && activeOrders.length > 0) {
                // Отменяем заказы
                activeOrders.forEach(order => {
                    cancelOrder(order.id, `Заказ отменен из-за увольнения водителя. ${reason ? 'Причина: ' + reason : ''}`);
                });
            }
            // Если action === 'keep', оставляем заказы текущему водителю

            // Создаем запись об увольнении
            const dismissalRecord = {
                id: Date.now(),
                userId: driverUserId,
                driverId: driver.id,
                reason: reason,
                dismissedBy: currentUser.id,
                dismissedAt: new Date().toISOString(),
                actionTaken: action,
                ordersAffected: activeOrders.length,
                rating: driver.rating,
                completedDeliveries: driver.completedDeliveries
            };

            let dismissals = JSON.parse(localStorage.getItem('transportco_driver_dismissals')) || [];
            dismissals.push(dismissalRecord);
            localStorage.setItem('transportco_driver_dismissals', JSON.stringify(dismissals));

            // Деактивируем водителя
            drivers[driverIndex].status = 'inactive';
            drivers[driverIndex].inactiveSince = new Date().toISOString();
            drivers[driverIndex].inactiveReason = 'dismissed';
            drivers[driverIndex].dismissalReason = reason;
            drivers[driverIndex].dismissedBy = currentUser.id;

            // Обновляем пользователя
            const userIndex = users.findIndex(u => u.id === driverUserId);
            if (userIndex !== -1) {
                users[userIndex].isDriver = false;
            }

            // Сохраняем изменения
            localStorage.setItem('transportco_drivers', JSON.stringify(drivers));
            localStorage.setItem('transportco_users', JSON.stringify(users));
            localStorage.setItem('transportco_orders', JSON.stringify(orders));

            // Уведомляем водителя
            createNotification(
                driverUserId,
                'Вы уволены',
                `Вы были уволены администратором.${reason ? ' Причина: ' + reason : ''}`,
                'error'
            );

            showNotification(`Водитель ${driverUser.firstName} ${driverUser.lastName} уволен`, 'success');

            if (document.getElementById('dismissDriverModal')) {
                closeModal('dismissDriverModal');
            }

            // Обновляем интерфейс
            if (driverUserId === currentUser.id) {
                currentUser.isDriver = false;
                localStorage.setItem('transportco_currentUser', JSON.stringify(currentUser));
                updateProfileNavigation();
                showProfileTab('data');
            }

            loadDriversList();
            loadAdminOrders();
        }

        // Функция восстановления водителя
        function restoreDriver(driverUserId) {
            if (!currentUser || !currentUser.isAdmin) {
                showNotification('Только администратор может восстановить водителя', 'error');
                return;
            }

            const driverIndex = drivers.findIndex(d => d.userId === driverUserId);
            if (driverIndex === -1) {
                showNotification('Водитель не найден', 'error');
                return;
            }

            drivers[driverIndex].status = 'active';
            drivers[driverIndex].inactiveSince = null;
            drivers[driverIndex].inactiveReason = null;

            // Обновляем пользователя
            const userIndex = users.findIndex(u => u.id === driverUserId);
            if (userIndex !== -1) {
                users[userIndex].isDriver = true;
            }

            localStorage.setItem('transportco_drivers', JSON.stringify(drivers));
            localStorage.setItem('transportco_users', JSON.stringify(users));

            // Уведомляем водителя
            createNotification(
                driverUserId,
                'Статус восстановлен',
                'Ваш статус водителя восстановлен администратором',
                'success'
            );

            showNotification('Статус водителя восстановлен', 'success');
            loadDriversList();
        }

        // Функция для отображения истории увольнений в профиле администратора
        function showResignationHistory() {
            const resignations = JSON.parse(localStorage.getItem('transportco_driver_resignations')) || [];
            const dismissals = JSON.parse(localStorage.getItem('transportco_driver_dismissals')) || [];

            const allRecords = [...resignations, ...dismissals]
                .sort((a, b) => new Date(b.dismissedAt || b.resignedAt) - new Date(a.dismissedAt || a.resignedAt));

            let html = `
                <div class="profile-section">
                    <h2>История увольнений водителей</h2>
                    <div class="orders-table-container" style="display: block;">
                        <div class="table-header">
                            <div class="table-header-item">ВОДИТЕЛЬ</div>
                            <div class="table-header-item">ТИП</div>
                            <div class="table-header-item">ПРИЧИНА</div>
                            <div class="table-header-item">ЗАКАЗОВ ЗАДЕТО</div>
                            <div class="table-header-item">ДАТА</div>
                            <div class="table-header-item">ДЕЙСТВИЯ</div>
                        </div>
            `;

            allRecords.forEach(record => {
                const user = users.find(u => u.id === record.userId);
                const driver = drivers.find(d => d.userId === record.userId);
                const isDismissal = 'dismissedBy' in record;

                html += `
                    <div class="order-row">
                        <div class="order-cell" data-label="Водитель">
                            ${user ? `${user.firstName} ${user.lastName}` : 'Неизвестно'}
                        </div>
                        <div class="order-cell" data-label="Тип">
                            <span class="order-status ${isDismissal ? 'cancelled' : 'processing'}">
                                ${isDismissal ? 'Уволен' : 'Уволился'}
                            </span>
                        </div>
                        <div class="order-cell" data-label="Причина">
                            ${record.reason || 'Не указана'}
                        </div>
                        <div class="order-cell" data-label="Заказов задето">
                            ${record.ordersAffected || 0}
                        </div>
                        <div class="order-cell date-container" data-label="Дата">
                            <span class="date-day">${new Date(record.dismissedAt || record.resignedAt).toLocaleDateString()}</span>
                        </div>
                        <div class="order-cell" data-label="Действия">
                            ${driver && driver.status === 'inactive' ?
                                `<button class="track-btn" onclick="restoreDriver(${record.userId})">Восстановить</button>` :
                                'Активен'
                            }
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            return html;
        }

        // ФУНКЦИИ ДЛЯ АДМИНИСТРАТОРА

        // Загрузка заказов для администратора
        function loadAdminOrders() {
            if (!currentUser || !currentUser.isAdmin) return;

            const container = document.getElementById('admin-orders-body');
            if (!container) return;

            let html = '';

            orders.forEach(order => {
                const user = users.find(u => u.id === order.userId);
                const driver = order.driverId ? drivers.find(d => d.userId === order.driverId) : null;
                const driverUser = driver ? users.find(u => u.id === driver.userId) : null;

                // Получаем статус для администратора
                const adminStatus = order.status;
                const statusText = getStatusText(adminStatus, true); // true = для администратора
                const statusClass = getStatusClass(adminStatus);

                html += `
                    <div class="order-row">
                        <div class="order-cell" data-label="Номер заказа">#${order.id}</div>
                        <div class="order-cell" data-label="Клиент">${user ? `${user.firstName} ${user.lastName}` : 'Неизвестно'}</div>
                        <div class="order-cell" data-label="Телефон">${order.senderPhone}</div>
                        <div class="order-cell address-container" data-label="Маршрут">
                            <span class="address-line">${order.pickupAddress || 'Не указан'}</span>
                            <span class="address-line"> → ${order.deliveryAddress || 'Не указан'}</span>
                        </div>
                        <div class="order-cell" data-label="Груз">${order.cargoDescription || 'Не указан'}</div>
                        <div class="order-cell" data-label="Статус">
                            <div class="order-status ${statusClass}">
                                <span class="status-icon">●</span>
                                <span>${statusText}</span>
                            </div>
                        </div>
                        <div class="order-cell" data-label="Водитель">${driverUser ? `${driverUser.firstName} ${driverUser.lastName}` : 'Не назначен'}</div>
                        <div class="order-cell" data-label="Цена">${order.price || 'Не указана'} ₽</div>
                        <div class="order-cell date-container" data-label="Дата">
                            <span class="date-day">${new Date(order.createdAt).toLocaleDateString()}</span>
                        </div>
                        <div class="order-cell" data-label="Действия">
                            <button class="view-btn" onclick="openAdminOrderDetails(${order.id})">Подробнее</button>
                            ${adminStatus === ORDER_STATUSES.ADMIN.NEW ? 
                            `<button class="track-btn" onclick="openOrderModal(${order.id})">Обработать</button>` : ''}
                            ${!order.driverId && adminStatus === ORDER_STATUSES.ADMIN.CONFIRMED ? 
                            `<button class="track-btn" onclick="assignDriverModal(${order.id})">Назначить водителя</button>` : ''}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            updateAdminStats();
        }

        // Модальное окно обработки заказа администратором
        function openOrderModal(orderId) {
            const existingModal = document.getElementById('orderProcessingModal');
            if (existingModal) {
                existingModal.remove();
            }

            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const user = users.find(u => u.id === order.userId);

            const modalHTML = `
                <div class="modal active" id="orderProcessingModal">
                    <div class="auth-container" style="max-width: 600px;">
                        <div class="auth-header">
                            <button class="close-auth-btn" onclick="closeModal('orderProcessingModal')">×</button>
                            <div class="auth-logo">Обработка заказа #${orderId}</div>
                        </div>

                        <div class="auth-form-container">
                            <h3>Детали заказа</h3>
                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label>Клиент:</label>
                                    <input type="text" class="profile-field-readonly" value="${user ? `${user.firstName} ${user.lastName}` : 'Неизвестно'}" readonly>
                                </div>
                                <div class="order-form-group">
                                    <label>Телефон:</label>
                                    <input type="text" class="profile-field-readonly" value="${order.senderPhone}" readonly>
                                </div>
                            </div>

                            <div class="order-form-group">
                                <label>Маршрут:</label>
                                <input type="text" class="profile-field-readonly" value="${order.pickupAddress} → ${order.deliveryAddress}" readonly>
                            </div>

                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label>Груз:</label>
                                    <input type="text" class="profile-field-readonly" value="${order.cargoDescription}" readonly>
                                </div>
                                <div class="order-form-group">
                                    <label>Вес/Объем:</label>
                                    <input type="text" class="profile-field-readonly" value="${order.cargoWeight} кг / ${order.cargoVolume} м³" readonly>
                                </div>
                            </div>

                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label>Стоимость:</label>
                                    <input type="text" class="profile-field-readonly" value="${order.price} ₽" readonly>
                                </div>
                                <div class="order-form-group">
                                    <label>Дата отправки:</label>
                                    <input type="text" class="profile-field-readonly" value="${new Date(order.shippingDate).toLocaleDateString()}" readonly>
                                </div>
                            </div>

                            <h3>Решение по заказу</h3>
                            <div class="order-form-group">
                                <label for="order-decision">Решение:</label>
                                <select id="order-decision">
                                    <option value="confirm">Подтвердить заказ</option>
                                    <option value="reject">Отклонить заказ</option>
                                </select>
                            </div>

                            <div class="order-form-group">
                                <label for="admin-comment">Комментарий для клиента:</label>
                                <textarea id="admin-comment" rows="3" placeholder="Введите комментарий для клиента..."></textarea>
                            </div>

                            <div class="forgot-password-buttons">
                                <button class="back-btn" onclick="closeModal('orderProcessingModal')">Отмена</button>
                                <button class="recovery-btn" onclick="processOrderDecision(${orderId})">Применить решение</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Обработка решения администратора
        function processOrderDecision(orderId) {
            const decisionElement = document.getElementById('order-decision');
            const commentElement = document.getElementById('admin-comment');

            if (!decisionElement || !commentElement) {
                showNotification('Ошибка: элементы формы не найдены', 'error');
                return;
            }

            const decision = document.getElementById('order-decision').value;
            const comment = document.getElementById('admin-comment').value;

            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;

            let newStatus = '';
            let clientStatus = '';
            let notificationMessage = '';

            switch(decision) {
                case 'confirm':
                    newStatus = ORDER_STATUSES.ADMIN.CONFIRMED;
                    clientStatus = ORDER_STATUSES.CLIENT.CONFIRMED;
                    notificationMessage = 'Ваш заказ подтвержден. Ожидайте назначения водителя.';
                    break;
                case 'reject':
                    newStatus = ORDER_STATUSES.ADMIN.REJECTED;
                    clientStatus = ORDER_STATUSES.CLIENT.REJECTED;
                    notificationMessage = `Ваш заказ отклонен. Причина: ${comment || 'Не указана'}`;
                    break;
            }

            if (newStatus) {
                orders[orderIndex].status = newStatus;
                if (clientStatus) {
                    orders[orderIndex].clientStatus = clientStatus;
                }
                orders[orderIndex].adminComment = comment;
                orders[orderIndex].processedAt = new Date().toISOString();
                localStorage.setItem('transportco_orders', JSON.stringify(orders));
            }

            // Отправляем уведомление пользователю
            if (decision !== 'request_info') {
                createNotification(
                    orders[orderIndex].userId,
                    'Обновление статуса заказа',
                    notificationMessage,
                    decision === 'confirm' ? 'success' : 'warning'
                );
            }

            showNotification('Заказ подтвержден', 'success');
            closeModal('orderProcessingModal');
            loadAdminOrders();
        }

        // Модальное окно назначения водителя
        function assignDriverModal(orderId) {
            const activeDrivers = drivers.filter(d => d.status === 'active' && d.workStatus === 'active');

            let driversHTML = '';
            activeDrivers.forEach(driver => {
                const user = users.find(u => u.id === driver.userId);
                if (user) {
                    driversHTML += `
                        <div class="checkbox-group">
                            <label>
                                <input type="radio" name="selectedDriver" value="${driver.userId}">
                                ${user.firstName} ${user.lastName} - ${driver.carModel} (${driver.carNumber})
                                - Доставок: ${driver.completedDeliveries}
                            </label>
                        </div>
                    `;
                }
            });

            const modalHTML = `
                <div class="modal active" id="assignDriverModal">
                    <div class="auth-container" style="max-width: 500px;">
                        <div class="auth-header">
                            <button class="close-auth-btn" onclick="closeModal('assignDriverModal')">×</button>
                            <div class="auth-logo">Назначение водителя</div>
                        </div>

                        <div class="auth-form-container">
                            <p>Выберите водителя для заказа #${orderId}</p>

                            <div id="drivers-list">
                                ${driversHTML || '<p>Нет доступных водителей</p>'}
                            </div>

                            <div class="forgot-password-buttons">
                                <button class="back-btn" onclick="closeModal('assignDriverModal')">Отмена</button>
                                <button class="recovery-btn" onclick="assignDriverToOrder(${orderId})">Назначить</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Назначение водителя на заказ
        function assignDriverToOrder(orderId) {
            const selectedDriver = document.querySelector('input[name="selectedDriver"]:checked');
            if (!selectedDriver) {
                showNotification('Выберите водителя', 'warning');
                return;
            }

            const driverId = parseInt(selectedDriver.value);
            const orderIndex = orders.findIndex(o => o.id === orderId);

            if (orderIndex === -1) return;

            orders[orderIndex].driverId = driverId;
            orders[orderIndex].assignedAt = new Date().toISOString();
            localStorage.setItem('transportco_orders', JSON.stringify(orders));

            // Отправляем уведомление водителю
            const driverUser = users.find(u => u.id === driverId);
            if (driverUser) {
                createNotification(
                    driverId,
                    'Новый заказ назначен',
                    `Вам назначен новый заказ #${orderId}. Проверьте вкладку "Доступные заказы".`,
                    'info'
                );
            }

            // Отправляем уведомление клиенту
            createNotification(
                orders[orderIndex].userId,
                'Водитель назначен',
                `На ваш заказ назначен водитель. Ожидайте подтверждения принятия заказа.`,
                'info'
            );

            showNotification('Водитель успешно назначен', 'success');
            closeModal('assignDriverModal');
            loadAdminOrders();
        }

        // Загрузка заявок водителей
        function loadDriverApplications() {
            if (!currentUser || !currentUser.isAdmin) return;

            const container = document.getElementById('driver-applications-body');
            if (!container) return;

            let html = '';

            driverApplications.forEach((app, index) => {
                const user = users.find(u => u.id === app.userId);
                if (!user) return;

                html += `
                    <div class="order-row">
                        <div class="order-cell" data-label="ID">${index + 1}</div>
                        <div class="order-cell" data-label="ФИО">${user.firstName} ${user.lastName}</div>
                        <div class="order-cell" data-label="Телефон">${user.phone}</div>
                        <div class="order-cell" data-label="Вод. удост.">${app.licenseNumber}</div>
                        <div class="order-cell" data-label="Автомобиль">${app.carModel} (${app.carNumber})</div>
                        <div class="order-cell" data-label="Опыт">${app.experience} лет</div>
                        <div class="order-cell" data-label="Статус">
                            <span class="order-status ${app.status === 'pending' ? 'processing' : app.status === 'approved' ? 'delivered' : 'cancelled'}">
                                ${app.status === 'pending' ? 'На рассмотрении' : app.status === 'approved' ? 'Одобрена' : 'Отклонена'}
                            </span>
                        </div>
                        <div class="order-cell date-container" data-label="Дата">
                            <span class="date-day">${new Date(app.appliedAt).toLocaleDateString()}</span>
                        </div>
                        <div class="order-cell" data-label="Действия">
                            ${app.status === 'pending' ? `
                                <button class="track-btn" style="margin-bottom: 5px;" onclick="processApplication(${app.id}, 'approved')">Нанять</button>
                                <button class="view-btn" onclick="processApplication(${app.id}, 'rejected')">Отклонить</button>
                            ` : 'Обработана'}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Обработка заявки водителя
        function processApplication(appId, decision) {
            const appIndex = driverApplications.findIndex(a => a.id === appId);
            if (appIndex === -1) return;

            const application = driverApplications[appIndex];

            if (decision === 'approved') {
                // Создаем запись водителя
                const newDriver = {
                    id: drivers.length + 1,
                    userId: application.userId,
                    licenseNumber: application.licenseNumber,
                    carModel: application.carModel,
                    carNumber: application.carNumber,
                    maxWeight: application.maxWeight,
                    status: 'active',
                    workStatus: 'active',
                    rating: 5.0,
                    completedDeliveries: 0,
                    hireDate: new Date().toISOString().split('T')[0]
                };

                drivers.push(newDriver);
                localStorage.setItem('transportco_drivers', JSON.stringify(drivers));

                // Обновляем роль пользователя
                const userIndex = users.findIndex(u => u.id === application.userId);
                if (userIndex !== -1) {
                    users[userIndex].isDriver = true;
                    localStorage.setItem('transportco_users', JSON.stringify(users));

                    // Если это текущий пользователь, обновляем его данные
                    if (currentUser && currentUser.id === application.userId) {
                        currentUser.isDriver = true;
                        localStorage.setItem('transportco_currentUser', JSON.stringify(currentUser));
                    }
                }

                // Отправляем уведомление
                createNotification(
                    application.userId,
                    'Заявка одобрена',
                    'Поздравляем! Ваша заявка на роль водителя одобрена. Теперь вы можете принимать заказы.',
                    'success'
                );
            } else {
                // Отправляем уведомление об отклонении
                createNotification(
                    application.userId,
                    'Заявка отклонена',
                    'Ваша заявка на роль водителя отклонена. Подробности уточняйте у администратора.',
                    'warning'
                );
            }

            // Обновляем статус заявки
            driverApplications[appIndex].status = decision;
            driverApplications[appIndex].processedAt = new Date().toISOString();
            driverApplications[appIndex].processedBy = currentUser.id;

            localStorage.setItem('transportco_driver_applications', JSON.stringify(driverApplications));

            showNotification(`Заявка ${decision === 'approved' ? 'одобрена' : 'отклонена'}`, 'success');
            loadDriverApplications();
            loadDriversList();
        }

        // Загрузка списка водителей
        function loadDriversList() {
            if (!currentUser || !currentUser.isAdmin) return;

            const container = document.getElementById('drivers-list-body');
            if (!container) return;

            let html = '';

            drivers.forEach((driver, index) => {
                const user = users.find(u => u.id === driver.userId);
                if (!user) return;

                const activeOrders = orders.filter(order =>
                    order.driverId === driver.userId &&
                    (order.status === 'confirmed' || order.status === 'in_transit')
                ).length;

                html += `
                    <div class="order-row">
                        <div class="order-cell" data-label="ID">${index + 1}</div>
                        <div class="order-cell" data-label="ФИО">${user.firstName} ${user.lastName}</div>
                        <div class="order-cell" data-label="Телефон">${user.phone}</div>
                        <div class="order-cell" data-label="Автомобиль">${driver.carModel} (${driver.carNumber})</div>
                        <div class="order-cell" data-label="Доставок">${driver.completedDeliveries || 0}</div>
                        <div class="order-cell" data-label="Статус работы">
                            <span class="order-status ${driver.workStatus === 'active' ? 'delivered' : 'cancelled'}">
                                ${driver.workStatus === 'active' ? 'Активен' : 'Неактивен'}
                            </span>
                        </div>
                        <div class="order-cell date-container" data-label="Дата найма">
                            <span class="date-day">${new Date(driver.hireDate).toLocaleDateString()}</span>
                        </div>
                        <div class="order-cell" data-label="Действия">
                            <button class="view-btn" onclick="openDriverDetailsModal(${driver.userId})">Подробнее</button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Функция загрузки истории увольнений
        function loadDismissalHistory() {
            if (!currentUser || !currentUser.isAdmin) return;

            const container = document.getElementById('dismissal-history-body');
            const noHistory = document.getElementById('no-dismissal-history');
            if (!container) return;

            // Получаем данные из localStorage
            let dismissals = JSON.parse(localStorage.getItem('transportco_driver_dismissals')) || [];
            let resignations = JSON.parse(localStorage.getItem('transportco_driver_resignations')) || [];

            // Объединяем все записи
            const allRecords = [...dismissals, ...resignations]
                .sort((a, b) => new Date(b.dismissedAt || b.resignedAt) - new Date(a.dismissedAt || a.resignedAt));

            if (allRecords.length === 0) {
                if (container) container.style.display = 'none';
                if (noHistory) noHistory.style.display = 'block';
                return;
            }

            let html = '';

            allRecords.forEach((record, index) => {
                const user = users.find(u => u.id === record.userId);
                const driver = drivers.find(d => d.userId === record.userId);
                const isDismissal = 'dismissedBy' in record;

                html += `
                    <div class="order-row">
                        <div class="order-cell" data-label="Водитель">
                            ${user ? `${user.firstName} ${user.lastName}` : 'Неизвестно'}
                        </div>
                        <div class="order-cell" data-label="Тип">
                            <span class="order-status ${isDismissal ? 'cancelled' : 'processing'}">
                                ${isDismissal ? 'Уволен' : 'Уволился'}
                            </span>
                        </div>
                        <div class="order-cell" data-label="Причина">
                            ${record.reason || 'Не указана'}
                        </div>
                        <div class="order-cell" data-label="Заказов задето">
                            ${record.ordersAffected || 0}
                        </div>
                        <div class="order-cell date-container" data-label="Дата">
                            <span class="date-day">${new Date(record.dismissedAt || record.resignedAt).toLocaleDateString()}</span>
                        </div>
                        <div class="order-cell" data-label="Действия">
                            <div style="display: flex; flex-direction: column; gap: 5px;">
                                <button class="view-btn" onclick="viewDismissalDetails(${record.userId})">Подробнее</button>
                                ${driver && driver.status === 'inactive' && isDismissal ?
                                    `<button class="track-btn" onclick="restoreDriver(${record.userId})">Восстановить</button>` :
                                    ''
                                }
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            if (container) container.style.display = 'block';
            if (noHistory) noHistory.style.display = 'none';
        }

        // Функция просмотра деталей увольнения
        function viewDismissalDetails(userId) {
            const user = users.find(u => u.id === userId);
            const driver = drivers.find(d => d.userId === userId);
            let dismissals = JSON.parse(localStorage.getItem('transportco_driver_dismissals')) || [];
            let resignations = JSON.parse(localStorage.getItem('transportco_driver_resignations')) || [];

            const dismissalRecord = dismissals.find(d => d.userId === userId);
            const resignationRecord = resignations.find(r => r.userId === userId);
            const record = dismissalRecord || resignationRecord;

            if (!record) return;

            const isDismissal = 'dismissedBy' in record;
            const dismissedByUser = isDismissal ? users.find(u => u.id === record.dismissedBy) : null;

            let modalHTML = `
                <div class="modal active" id="dismissalDetailsModal">
                    <div class="auth-container" style="max-width: 600px;">
                        <div class="auth-header">
                            <button class="close-auth-btn" onclick="closeModal('dismissalDetailsModal')">×</button>
                            <div class="auth-logo">Детали ${isDismissal ? 'увольнения' : 'ухода'}</div>
                        </div>

                        <div class="auth-form-container">
                            <h3>Информация о водителе</h3>
                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label>ФИО:</label>
                                    <input type="text" class="profile-field-readonly" value="${user ? `${user.firstName} ${user.lastName}` : 'Неизвестно'}" readonly>
                                </div>
                                <div class="order-form-group">
                                    <label>Телефон:</label>
                                    <input type="text" class="profile-field-readonly" value="${user ? user.phone : 'Неизвестно'}" readonly>
                                </div>
                            </div>

                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label>Автомобиль:</label>
                                    <input type="text" class="profile-field-readonly" value="${driver ? `${driver.carModel} (${driver.carNumber})` : 'Неизвестно'}" readonly>
                                </div>
                                <div class="order-form-group">
                                    <label>Тип ${isDismissal ? 'увольнения' : 'ухода'}:</label>
                                    <input type="text" class="profile-field-readonly" value="${isDismissal ? 'Уволен администратором' : 'Уволился самостоятельно'}" readonly>
                                </div>
                            </div>

                            <div class="order-form-group">
                                <label>Причина:</label>
                                <textarea class="profile-field-readonly" rows="3" readonly>${record.reason || 'Не указана'}</textarea>
                            </div>

                            <div class="order-form-row">
                                <div class="order-form-group">
                                    <label>Дата:</label>
                                    <input type="text" class="profile-field-readonly" value="${new Date(record.dismissedAt || record.resignedAt).toLocaleString()}" readonly>
                                </div>
                                ${isDismissal ? `
                                    <div class="order-form-group">
                                        <label>Уволил:</label>
                                        <input type="text" class="profile-field-readonly" value="${dismissedByUser ? `${dismissedByUser.firstName} ${dismissedByUser.lastName}` : 'Неизвестно'}" readonly>
                                    </div>
                                ` : ''}
                            </div>

                            ${record.ordersAffected ? `
                                <div class="order-form-group">
                                    <label>Заказов задето:</label>
                                    <input type="text" class="profile-field-readonly" value="${record.ordersAffected}" readonly>
                                </div>
                            ` : ''}

                            ${record.actionTaken ? `
                                <div class="order-form-group">
                                    <label>Действие с заказами:</label>
                                    <input type="text" class="profile-field-readonly" value="${getActionTakenText(record.actionTaken)}" readonly>
                                </div>
                            ` : ''}

                            <div class="forgot-password-buttons">
                                ${driver && driver.status === 'inactive' && isDismissal ?
                                    `<button class="recovery-btn" onclick="restoreDriver(${userId}); closeModal('dismissalDetailsModal')">Восстановить водителя</button>` :
                                    ''
                                }
                                <button class="back-btn" onclick="closeModal('dismissalDetailsModal')">Закрыть</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Вспомогательная функция для текста действий
        function getActionTakenText(action) {
            const actions = {
                'reassign': 'Переназначены другому водителю',
                'cancel': 'Отменены с возвратом средств',
                'keep': 'Оставлены текущему водителю'
            };
            return actions[action] || action;
        }
        // Изменение статуса водителя
        function toggleDriverStatus(userId) {
            const driverIndex = drivers.findIndex(d => d.userId === userId);
            if (driverIndex === -1) return;

            drivers[driverIndex].status = drivers[driverIndex].status === 'active' ? 'inactive' : 'active';
            localStorage.setItem('transportco_drivers', JSON.stringify(drivers));

            // Отправляем уведомление водителю
            createNotification(
                userId,
                'Изменение статуса',
                `Ваш статус изменен на "${drivers[driverIndex].status === 'active' ? 'Активен' : 'Неактивен'}".`,
                'info'
            );

            showNotification('Статус водителя изменен', 'success');
            loadDriversList();
        }

        // Обновление статистики администратора
        function updateAdminStats() {
            if (!currentUser || !currentUser.isAdmin) return;

            // Общая статистика
            document.getElementById('admin-total-orders').textContent = orders.length;
            document.getElementById('admin-active-drivers').textContent = drivers.filter(d => d.status === 'active').length;

            // Заказы за сегодня
            const today = new Date().toDateString();
            const todayOrders = orders.filter(order =>
                new Date(order.createdAt).toDateString() === today
            );
            document.getElementById('admin-today-orders').textContent = todayOrders.length;

            // Выручка
            const totalRevenue = orders
                .filter(order => order.status === 'delivered')
                .reduce((sum, order) => sum + (order.price || 0), 0);
            document.getElementById('admin-total-revenue').textContent = totalRevenue;

            // Статистика по статусам
            document.getElementById('stats-new-orders').value = orders.filter(o => o.status === 'new').length;
            document.getElementById('stats-confirmed-orders').value = orders.filter(o => o.status === 'confirmed').length;
            document.getElementById('stats-transit-orders').value = orders.filter(o => o.status === 'in_transit').length;
            document.getElementById('stats-delivered-orders').value = orders.filter(o => o.status === 'delivered').length;
        }

        //  ОБЩИЕ ФУНКЦИИ 

        // Отправка заявки на роль водителя
        function submitDriverApplication(event) {
            event.preventDefault();

            if (!currentUser) {
                showNotification('Для подачи заявки необходимо авторизоваться', 'warning');
                return false;
            }

            // Проверяем, нет ли уже заявки
            const existingApp = driverApplications.find(app =>
                app.userId === currentUser.id && app.status === 'pending'
            );

            if (existingApp) {
                showNotification('У вас уже есть активная заявка на рассмотрении', 'warning');
                return false;
            }

            const application = {
                id: driverApplications.length + 1,
                userId: currentUser.id,
                licenseNumber: document.getElementById('driver-license').value,
                experience: parseInt(document.getElementById('driver-experience').value),
                carModel: document.getElementById('car-model').value,
                carNumber: document.getElementById('car-number').value,
                maxWeight: parseInt(document.getElementById('max-weight').value),
                carType: document.getElementById('car-type').value,
                status: 'pending',
                appliedAt: new Date().toISOString()
            };

            driverApplications.push(application);
            localStorage.setItem('transportco_driver_applications', JSON.stringify(driverApplications));

            // Показываем статус заявки
            document.getElementById('driver-application-status').style.display = 'block';
            document.getElementById('application-status-content').innerHTML = `
                <div class="order-status processing">
                    <span class="status-icon">●</span>
                    <span>Заявка отправлена на рассмотрение</span>
                </div>
                <p style="margin-top: 10px;">Мы рассмотрим вашу заявку в течение 3 рабочих дней.</p>
            `;

            // Отправляем уведомление администраторам
            admins.forEach(admin => {
                createNotification(
                    admin.userId,
                    'Новая заявка водителя',
                    `Поступила новая заявка от ${currentUser.firstName} ${currentUser.lastName}`,
                    'info'
                );
            });

            showNotification('Заявка успешно отправлена!', 'success');
            return false;
        }

        // Создание уведомления
        function createNotification(userId, title, message, type = 'info') {
            const notification = {
                id: notifications.length + 1,
                userId: userId,
                title: title,
                message: message,
                type: type,
                read: false,
                createdAt: new Date().toISOString()
            };

            notifications.push(notification);
            localStorage.setItem('transportco_notifications', JSON.stringify(notifications));

            // Если это текущий пользователь, показываем уведомление
            if (currentUser && currentUser.id === userId) {
                showNotification(`${title}: ${message}`, type);
            }

            return notification;
        }

        // Пометка уведомления как прочитанного
        function markNotificationAsRead(notificationId) {
            const notificationIndex = notifications.findIndex(n => n.id === notificationId);
            if (notificationIndex !== -1) {
                notifications[notificationIndex].read = true;
                localStorage.setItem('transportco_notifications', JSON.stringify(notifications));
            }
        }

        // Закрытие модального окна
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => {
                    if (modal.parentElement) {
                        modal.remove();
                    }
                }, 300);
            }
        }

        // Функции сброса фильтров
        function resetDriverFilters() {
            document.getElementById('driver-distance-filter').value = 'all';
            document.getElementById('driver-weight-filter').value = 'all';
            document.getElementById('driver-date-filter').value = 'all';
        }

        //
        function showProfileTab(tabName) {
            // Скрываем все вкладки
            const tabs = document.querySelectorAll('.profile-tab');
            tabs.forEach(tab => tab.style.display = 'none');

            // Убираем активный класс у всех кнопок
            const navButtons = document.querySelectorAll('.profile-nav-btn');
            navButtons.forEach(btn => btn.classList.remove('active'));

            // Добавляем активный класс нажатой кнопке
            const activeBtn = document.querySelector(`.profile-nav-btn[onclick*="${tabName}"]`);
            if (activeBtn) activeBtn.classList.add('active');

            // Показываем выбранную вкладку
            const tabElement = document.getElementById(`profile-${tabName}`);
            if (tabElement) {
                tabElement.style.display = 'block';

                // Загружаем данные для вкладки
                switch(tabName) {
                    case 'orders':
                        loadUserOrders(); 
                        break;
                    case 'driver-active-orders':
                        loadDriverActiveOrders();
                        break;
                    case 'driver-history':
                        loadDriverHistory();
                        break;
                    case 'driver-stats':
                        updateDriverStats();
                        break;
                    case 'admin-orders':
                        loadAdminOrders();
                        break;
                    case 'driver-applications':
                        loadDriverApplications();
                        break;
                    case 'drivers-list':
                        loadDriversList();
                        break;
                    case 'resignation-history':
                        loadDismissalHistory();
                        break;
                    case 'admin-stats':
                        updateAdminStats();
                        break;
                    case 'become-driver':
                        checkDriverApplicationStatus();
                        break;
                }
            }
        }

        // Проверка статуса заявки водителя
        function checkDriverApplicationStatus() {
            if (!currentUser) return;

            const existingApp = driverApplications.find(app => app.userId === currentUser.id);
            const statusDiv = document.getElementById('driver-application-status');
            const contentDiv = document.getElementById('application-status-content');

            if (existingApp) {
                statusDiv.style.display = 'block';

                let statusHTML = '';
                if (existingApp.status === 'pending') {
                    statusHTML = `
                        <div class="order-status processing">
                            <span class="status-icon">●</span>
                            <span>Заявка на рассмотрении</span>
                        </div>
                        <p style="margin-top: 10px;">Дата подачи: ${new Date(existingApp.appliedAt).toLocaleDateString()}</p>
                    `;
                } else if (existingApp.status === 'approved') {
                    statusHTML = `
                        <div class="order-status delivered">
                            <span class="status-icon">●</span>
                            <span>Заявка одобрена</span>
                        </div>
                        <p style="margin-top: 10px;">Поздравляем! Теперь вы водитель.</p>
                    `;
                } else {
                    statusHTML = `
                        <div class="order-status cancelled">
                            <span class="status-icon">●</span>
                            <span>Заявка отклонена</span>
                        </div>
                        <p style="margin-top: 10px;">Дата обработки: ${new Date(existingApp.processedAt).toLocaleDateString()}</p>
                    `;
                }

                contentDiv.innerHTML = statusHTML;
            } else {
                statusDiv.style.display = 'none';
            }
        }

        // Детали заказа
        function openAdminOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const user = users.find(u => u.id === order.userId);
            const driver = order.driverId ? drivers.find(d => d.userId === order.driverId) : null;
            const driverUser = driver ? users.find(u => u.id === driver.userId) : null;

            const adminStatus = order.status;
            const clientStatus = order.clientStatus || order.status;
            const adminStatusText = getStatusText(adminStatus, true);
            const clientStatusText = getStatusText(clientStatus, false);

            let modalHTML = `
                <div class="modal active" id="adminOrderDetailsModal">
                    <div class="auth-container order-details-modal">
                        <div class="auth-header">
                            <button class="close-auth-btn" onclick="closeModal('adminOrderDetailsModal')">×</button>
                            <div class="auth-logo">Заказ #${orderId}</div>
                        </div>

                        <div class="auth-form-container">
                            <div class="order-form-row">
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Статус (админ)</div>
                                    <div class="order-detail-value">
                                        <span class="status-badge status-${adminStatus}">${adminStatusText}</span>
                                    </div>
                                </div>
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Статус (клиент)</div>
                                    <div class="order-detail-value">
                                        <span class="status-badge status-${clientStatus}">${clientStatusText}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Остальные детали заказа -->
                            <div class="order-detail-item">
                                <div class="order-detail-label">Клиент</div>
                                <div class="order-detail-value">${user ? `${user.firstName} ${user.lastName}` : 'Неизвестно'}</div>
                            </div>

                            <div class="order-detail-item">
                                <div class="order-detail-label">Телефон</div>
                                <div class="order-detail-value">${order.senderPhone}</div>
                            </div>

                            <div class="order-detail-item">
                                <div class="order-detail-label">Маршрут</div>
                                <div class="order-detail-value">
                                    <div><strong>Откуда:</strong> ${order.pickupAddress}</div>
                                    <div><strong>Куда:</strong> ${order.deliveryAddress}</div>
                                    <div><strong>Расстояние:</strong> ${order.distance || 'Не указано'} км</div>
                                </div>
                            </div>

                            <div class="order-detail-item">
                                <div class="order-detail-label">Груз</div>
                                <div class="order-detail-value">
                                    <div><strong>Описание:</strong> ${order.cargoDescription}</div>
                                    <div><strong>Категория:</strong> ${getCategoryName(order.productCategory)}</div>
                                    <div><strong>Вес/Объем:</strong> ${order.cargoWeight} кг / ${order.cargoVolume} м³</div>
                                    ${order.cargoType ? `<div><strong>Тип:</strong> ${getCargoTypeName(order.cargoType)}</div>` : ''}
                                </div>
                            </div>

                            <div class="order-detail-item">
                                <div class="order-detail-label">Стоимость</div>
                                <div class="order-detail-value">
                                    <div><strong>Общая:</strong> ${order.price || 'Не указана'} ₽</div>
                                    ${order.cancellationFee ? `<div><strong>Штраф за отмену:</strong> ${order.cancellationFee} ₽</div>` : ''}
                                    ${order.refundAmount ? `<div><strong>К возврату:</strong> ${order.refundAmount} ₽</div>` : ''}
                                </div>
                            </div>

                            ${driverUser ? `
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Водитель</div>
                                    <div class="order-detail-value">
                                        <div><strong>ФИО:</strong> ${driverUser.firstName} ${driverUser.lastName}</div>
                                        <div><strong>Автомобиль:</strong> ${driver.carModel} (${driver.carNumber})</div>
                                        <div><strong>Телефон:</strong> ${driverUser.phone}</div>
                                    </div>
                                </div>
                            ` : ''}

                            ${order.comments ? `
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Комментарий клиента</div>
                                    <div class="order-detail-value">${order.comments}</div>
                                </div>
                            ` : ''}

                            ${order.adminComment ? `
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Комментарий администратора</div>
                                    <div class="order-detail-value">${order.adminComment}</div>
                                </div>
                            ` : ''}

                            ${order.cancellationReason ? `
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Причина отмены</div>
                                    <div class="order-detail-value">${order.cancellationReason}</div>
                                </div>
                            ` : ''}

                            <div class="forgot-password-buttons">
                                ${adminStatus === ORDER_STATUSES.ADMIN.NEW ? `
                                    <button class="recovery-btn" onclick="openOrderModal(${orderId}); closeModal('adminOrderDetailsModal')">Обработать заказ</button>
                                ` : ''}

                                ${adminStatus === ORDER_STATUSES.ADMIN.CONFIRMED && !order.driverId ? `
                                    <button class="recovery-btn" onclick="assignDriverModal(${orderId}); closeModal('adminOrderDetailsModal')">Назначить водителя</button>
                                ` : ''}

                                <button class="back-btn" onclick="closeModal('adminOrderDetailsModal')">Закрыть</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function openCancelOrderModal(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const modalHTML = `
                <div class="modal active" id="cancelOrderModal">
                    <div class="auth-container" style="max-width: 500px;">
                        <div class="auth-header">
                            <button class="close-auth-btn" onclick="closeModal('cancelOrderModal')">×</button>
                            <div class="auth-logo">Отмена заказа #${orderId}</div>
                        </div>

                        <div class="auth-form-container">
                            <p style="margin-bottom: 20px; color: #666;">Вы собираетесь отменить заказ. Пожалуйста, укажите причину отмены.</p>

                            <div class="order-form-group">
                                <label for="cancelReason">Причина отмены:</label>
                                <select id="cancelReason" style="margin-bottom: 10px;">
                                    <option value="">Выберите причину</option>
                                    <option value="changed_plans">Изменились планы</option>
                                    <option value="found_cheaper">Нашел более дешевый вариант</option>
                                    <option value="no_longer_needed">Груз больше не нужен</option>
                                    <option value="date_issue">Проблемы с датой отправки</option>
                                    <option value="other">Другое</option>
                                </select>
                                <textarea id="cancelReasonDetails" rows="3" placeholder="Дополнительные детали (необязательно)"></textarea>
                            </div>

                            <div class="important-notice" style="margin: 20px 0;">
                                <p><strong>Внимание!</strong> При отмене заказа может быть удержана часть суммы в качестве штрафа.</p>
                            </div>

                            <div class="forgot-password-buttons">
                                <button class="back-btn" onclick="closeModal('cancelOrderModal')">Отмена</button>
                                <button class="recovery-btn" onclick="confirmCancelOrder(${orderId})" style="background: #dc3545;">Подтвердить отмену</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Подтверждение отмены заказа
        function confirmCancelOrder(orderId) {
            const reasonSelect = document.getElementById('cancelReason');
            const reasonDetails = document.getElementById('cancelReasonDetails').value;
            
            let reason = '';
            if (reasonSelect.value === 'other') {
                reason = reasonDetails;
            } else {
                reason = reasonSelect.options[reasonSelect.selectedIndex].textContent;
                if (reasonDetails.trim()) {
                    reason += ': ' + reasonDetails;
                }
            }

            if (!reason.trim()) {
                showNotification('Укажите причину отмены', 'warning');
                return;
            }

            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;

            // Сохраняем предыдущий статус для расчета штрафа
            const previousStatus = orders[orderIndex].status;
            let feePercentage = 0;
            let fee = 0;

            // Расчет штрафа в зависимости от статуса заказа
            if (previousStatus === ORDER_STATUSES.ADMIN.CONFIRMED) {
                feePercentage = 10; // 10% штраф
                fee = Math.round(orders[orderIndex].price * 0.10);
            } else if (previousStatus === ORDER_STATUSES.ADMIN.IN_TRANSIT) {
                feePercentage = 30; // 30% штраф
                fee = Math.round(orders[orderIndex].price * 0.30);
            }
            // Для нового заказа (status === 'new') штраф 0%

            const refundAmount = orders[orderIndex].price - fee;

            // Обновляем статусы
            orders[orderIndex].status = ORDER_STATUSES.ADMIN.CANCELLED_BY_CLIENT;
            orders[orderIndex].clientStatus = ORDER_STATUSES.CLIENT.CANCELLED;
            orders[orderIndex].cancellationReason = reason;
            orders[orderIndex].cancellationFee = fee;
            orders[orderIndex].refundAmount = refundAmount;
            orders[orderIndex].cancelledAt = new Date().toISOString();

            localStorage.setItem('transportco_orders', JSON.stringify(orders));

            // Создаем уведомление для клиента
            let notificationMessage = `Ваш заказ #${orderId} отменен.`;
            
            if (fee > 0) {
                notificationMessage += `<br>Стоимость заказа: ${orders[orderIndex].price} ₽`;
                notificationMessage += `<br>Удержан штраф за отмену: ${fee} ₽ (${feePercentage}%)`;
                notificationMessage += `<br>К возврату: ${refundAmount} ₽`;
            } else {
                notificationMessage += `<br>Стоимость заказа: ${orders[orderIndex].price} ₽ будет возвращена полностью.`;
            }
            
            notificationMessage += `<br>Причина отмены: ${reason}`;

            createNotification(
                orders[orderIndex].userId,
                'Заказ отменен',
                notificationMessage,
                'warning'
            );

            // Уведомляем администраторов
            const admins = users.filter(u => u.isAdmin);
            admins.forEach(admin => {
                createNotification(
                    admin.id,
                    'Заказ отменен клиентом',
                    `Заказ #${orderId} отменен клиентом.${fee > 0 ? ` Удержан штраф: ${fee} ₽.` : ''} Причина: ${reason}`,
                    'warning'
                );
            });
        
            closeModal('cancelOrderModal');
            
            if (document.getElementById('orderDetailsModal')) {
                closeModal('orderDetailsModal');
            }

            // Обновляем интерфейс
            if (currentUser.isAdmin) {
                loadAdminOrders();
            } else {
                updateProfileOrderStats();
            }
        }

        function openDriverDetailsModal(driverUserId) {
            const driver = drivers.find(d => d.userId === driverUserId);
            const driverUser = users.find(u => u.id === driverUserId);
            const application = driverApplications.find(app => app.userId === driverUserId);

            if (!driver || !driverUser) return;

            const modalHTML = `
                <div class="modal active" id="driverDetailsModal">
                    <div class="auth-container" style="max-width: 700px;">
                        <div class="auth-header">
                            <button class="close-auth-btn" onclick="closeModal('driverDetailsModal')">×</button>
                            <div class="auth-logo">Информация о водителе</div>
                        </div>

                        <div class="auth-form-container">
                            <h3>Личные данные</h3>
                            <div class="order-form-row">
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Имя Фамилия</div>
                                    <div class="order-detail-value">${driverUser.firstName} ${driverUser.lastName}</div>
                                </div>
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Статус</div>
                                    <div class="order-detail-value">
                                        <span class="status-badge ${driver.status === 'active' ? 'status-delivered' : 'status-cancelled'}">
                                            ${driver.status === 'active' ? 'Активен' : 'Неактивен'}
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="order-form-row">
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Телефон</div>
                                    <div class="order-detail-value">${driverUser.phone}</div>
                                </div>
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Email</div>
                                    <div class="order-detail-value">${driverUser.email}</div>
                                </div>
                            </div>

                            <h3>Данные из заявки</h3>
                            ${application ? `
                                <div class="order-form-row">
                                    <div class="order-detail-item">
                                        <div class="order-detail-label">Водительское удостоверение</div>
                                        <div class="order-detail-value">${application.licenseNumber || 'Не указано'}</div>
                                    </div>
                                    <div class="order-detail-item">
                                        <div class="order-detail-label">Опыт вождения</div>
                                        <div class="order-detail-value">${application.experience || 'Не указано'} лет</div>
                                    </div>
                                </div>

                                <div class="order-form-row">
                                    <div class="order-detail-item">
                                        <div class="order-detail-label">Дата подачи заявки</div>
                                        <div class="order-detail-value">${new Date(application.appliedAt).toLocaleDateString('ru-RU')}</div>
                                    </div>
                                    <div class="order-detail-item">
                                        <div class="order-detail-label">Статус заявки</div>
                                        <div class="order-detail-value">
                                            <span class="status-badge ${application.status === 'approved' ? 'status-delivered' :
                                                                        application.status === 'rejected' ? 'status-cancelled' : 'status-new'}">
                                                ${application.status === 'approved' ? 'Одобрена' :
                                                application.status === 'rejected' ? 'Отклонена' : 'На рассмотрении'}
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                ${application.additionalInfo ? `
                                    <div class="order-detail-item">
                                        <div class="order-detail-label">Дополнительная информация</div>
                                        <div class="order-detail-value">${application.additionalInfo}</div>
                                    </div>
                                ` : ''}
                            ` : '<p class="order-detail-value">Заявка не найдена</p>'}

                            <h3>Автомобиль</h3>
                            <div class="order-form-row">
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Модель</div>
                                    <div class="order-detail-value">${driver.carModel || 'Не указано'}</div>
                                </div>
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Госномер</div>
                                    <div class="order-detail-value">${driver.carNumber || 'Не указано'}</div>
                                </div>
                            </div>

                            <div class="order-form-row">
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Тип кузова</div>
                                    <div class="order-detail-value">${getCarTypeName(driver.carType) || 'Не указано'}</div>
                                </div>
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Грузоподъемность</div>
                                    <div class="order-detail-value">${driver.maxWeight || 'Не указано'} кг</div>
                                </div>
                            </div>

                            <h3>Статистика</h3>
                            <div class="order-form-row">
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Всего доставок</div>
                                    <div class="order-detail-value">${driver.completedDeliveries || 0}</div>
                                </div>
                            </div>

                            <div class="order-form-row">
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Доход</div>
                                    <div class="order-detail-value">${calculateDriverEarnings(driverUserId)} ₽</div>
                                </div>
                                <div class="order-detail-item">
                                    <div class="order-detail-label">Активных заказов</div>
                                    <div class="order-detail-value">
                                        ${orders.filter(o => o.driverId === driverUserId &&
                                            (o.status === 'confirmed' || o.status === 'in_transit')).length}
                                    </div>
                                </div>
                            </div>

                            <div class="forgot-password-buttons" style="margin-top: 20px;">
                                ${driver.status === 'active' ? `
                                    <button class="recovery-btn" style="background: #dc3545;" onclick="dismissDriver(${driverUserId})">Уволить</button>
                                ` : `
                                    <button class="recovery-btn" onclick="restoreDriver(${driverUserId})">Восстановить</button>
                                `}
                                <button class="back-btn" onclick="closeModal('driverDetailsModal')">Закрыть</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function changeOrderStatus(orderId, newStatus) {
            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;

            orders[orderIndex].status = newStatus;
            orders[orderIndex].statusUpdatedAt = new Date().toISOString();
            localStorage.setItem('transportco_orders', JSON.stringify(orders));

            showNotification('Статус заказа обновлен', 'success');
            loadAdminOrders(); // Перезагружаем таблицу
        }

        function renderDriverStatusDropdown(driverUserId, currentStatus) {
            return `
                <div style="display: flex; flex-direction: column; gap: 5px;">
                    <select class="status-dropdown" onchange="changeDriverStatus(${driverUserId}, this.value)"
                            style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ddd; font-size: 12px;
                                background-color: ${currentStatus === 'active' ? '#d4edda' : '#f8d7da'};">
                        <option value="active" ${currentStatus === 'active' ? 'selected' : ''}>Активен</option>
                        <option value="inactive" ${currentStatus === 'inactive' ? 'selected' : ''}>Неактивен</option>
                        <option value="pending" ${currentStatus === 'pending' ? 'selected' : ''}>На проверке</option>
                    </select>

                    ${currentStatus === 'active' ?
                        `<button class="track-btn" style="padding: 3px 8px; font-size: 11px;"
                                onclick="dismissDriver(${driverUserId})">Уволить</button>` :
                        `<button class="recovery-btn" style="padding: 3px 8px; font-size: 11px; background: #28a745;"
                                onclick="restoreDriver(${driverUserId})">Восстановить</button>`
                    }
                </div>
            `;
        }

        function loadUserOrders() {
            if (!currentUser) return;

            const userOrders = orders.filter(order => order.userId === currentUser.id);

            // Обновляем статистику
            updateProfileOrderStats(userOrders);

            // Показываем или скрываем таблицу
            if (userOrders.length > 0) {
                displayUserOrders(userOrders);
                document.getElementById('profile-orders-table').style.display = 'block';
                document.getElementById('profile-no-orders-message').style.display = 'none';
            } else {
                document.getElementById('profile-orders-table').style.display = 'none';
                document.getElementById('profile-no-orders-message').style.display = 'block';
            }
        }

        // Функция обновления статистики заказов
        function updateProfileOrderStats(userOrders = null) {
            if (!currentUser) return;
            
            const ordersToCount = userOrders || orders.filter(order => order.userId === currentUser.id);
            
            document.getElementById('profile-total-orders-count').textContent = ordersToCount.length;
            document.getElementById('profile-processing-orders-count').textContent = 
                ordersToCount.filter(order => order.clientStatus === 'processing' || order.status === 'new').length;
            document.getElementById('profile-in-transit-orders-count').textContent = 
                ordersToCount.filter(order => order.clientStatus === 'in_transit' || order.status === 'in_transit').length;
            document.getElementById('profile-delivered-orders-count').textContent = 
                ordersToCount.filter(order => order.clientStatus === 'delivered' || order.status === 'delivered').length;
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Установить сегодняшнюю дату в поле даты отправки
            const today = new Date().toISOString().split('T')[0];
            const shippingDate = document.getElementById('shipping-date');
            if (shippingDate) {
                shippingDate.min = today;
            }

            // Проверяем авторизацию при загрузке
            if (currentUser) {
                loginUser();
            }

            // По умолчанию показываем сообщение об отсутствии заказов
            toggleOrdersVisibility(false);

            // Автоматическое обновление статусов
            updateOrderStatuses();

            // Запускаем периодическую проверку статусов (каждые 5 минут)
            setInterval(updateOrderStatuses, 5 * 60 * 1000);

            // Обновляем кнопки в шапке в зависимости от роли
            updateHeaderButtons();

            // Загружаем данные для администратора
            if (currentUser && currentUser.isAdmin) {
                loadAdminOrders();
                loadDriverApplications();
                loadDriversList();
            }

            // Обновляем статус водителя при загрузке
            if (currentUser && currentUser.isDriver) {
                const driver = drivers.find(d => d.userId === currentUser.id);
                if (driver && !driver.workStatus) {
                    driver.workStatus = 'active';
                    localStorage.setItem('transportco_drivers', JSON.stringify(drivers));
                }
            }
        })

        // Функция для автоматического заполнения формы заказа данными пользователя
        function fillOrderFormWithUserData() {
            if (!currentUser) return;

            // Заполняем имя (имя + фамилия)
            const nameInput = document.getElementById('sender-name');
            if (nameInput && currentUser.firstName && currentUser.lastName) {
                nameInput.value = `${currentUser.firstName} ${currentUser.lastName}`;
            } else if (nameInput && currentUser.firstName) {
                nameInput.value = currentUser.firstName;
            } else if (nameInput && currentUser.lastName) {
                nameInput.value = currentUser.lastName;
            }

            // Заполняем телефон
            const phoneInput = document.getElementById('sender-phone');
            if (phoneInput && currentUser.phone) {
                phoneInput.value = currentUser.phone;
            }

            // Заполняем email
            const emailInput = document.getElementById('sender-email');
            if (emailInput && currentUser.email) {
                emailInput.value = currentUser.email;
            }
        }
    </script>
</body>
</html>